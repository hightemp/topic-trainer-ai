import{u as q}from"./data-Co8w_ojZ.js";import{c as L,d as D,r as v,l as C,x as T,m as _,a as i,f as s,i as m,u as p,C as z,t as n,p as f,B,g as I,F as N,b as V,o as r,n as M,_ as F}from"./index-B84cw-sY.js";import{a as $,d as H}from"./marked.esm-BzWFlwvj.js";const Q=L("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),j={class:"container"},E={class:"stats-grid mt-4"},J={class:"card stat-card"},O={class:"stat-icon"},R={class:"stat-info"},U={class:"stat-value"},G={class:"card stat-card"},K={class:"stat-icon"},P={class:"stat-info"},W={class:"stat-value"},X={class:"card mt-4"},Y={class:"flex justify-between items-center mb-4"},Z=["disabled"],ss=["innerHTML"],ts={key:1,class:"opacity-70"},es={class:"card mt-4"},as={class:"history-list mt-4"},ns={class:"history-header"},os={class:"date"},is={class:"history-q"},rs={class:"q-text-preview"},cs={class:"user-answer-preview"},ls={key:0,class:"opacity-70"},ds=D({__name:"StatsView",setup(us){const c=q(),o=v([]),S=v(!0),d=v(""),u=v(!1);C(async()=>{c.isLoaded||await c.loadData();const a=[];for(const t of c.questions){const e=await T.getAttemptsByQuestion(t.id);a.push(...e)}o.value=a.sort((t,e)=>e.date-t.date),S.value=!1});const l=_(()=>o.value.length),y=_(()=>l.value===0?0:(o.value.reduce((t,e)=>t+e.aiScore,0)/l.value).toFixed(1)),h=_(()=>o.value.slice(0,10));async function x(){if(o.value.length===0)return;u.value=!0;const a=o.value.slice(0,20).map(e=>{const g=c.questions.find(k=>k.id===e.questionId);return{question:g?g.text:"Deleted",score:e.aiScore,userAnswer:e.userAnswer,feedback:e.aiFeedback}}),t=`
  Total Attempts: ${l.value}
  Average Score: ${y.value}
  Recent Activity: ${JSON.stringify(a)}
`;try{const e=await $.chat([{role:"system",content:"Ты аналитик обучения. Проанализируй статистику пользователя и дай советы по улучшению знаний. Будь краток и конструктивен."},{role:"user",content:`Вот моя статистика:
${t}`}],async()=>({}));d.value=e.content||"Не удалось получить анализ."}catch(e){console.error(e),d.value="Ошибка анализа."}finally{u.value=!1}}function A(a){return H(a||"")}function b(a){return new Date(a).toLocaleDateString()+" "+new Date(a).toLocaleTimeString()}function w(a){const t=c.questions.find(e=>e.id===a);return t?t.text.substring(0,100)+(t.text.length>100?"...":""):"Вопрос удален"}return(a,t)=>(r(),i("div",j,[t[6]||(t[6]=s("h1",null,"Статистика",-1)),s("div",E,[s("div",J,[s("div",O,[m(p(z),{size:32})]),s("div",R,[s("span",U,n(l.value),1),t[0]||(t[0]=s("span",{class:"stat-label"},"Всего ответов",-1))])]),s("div",G,[s("div",K,[m(p(Q),{size:32})]),s("div",P,[s("span",W,n(y.value),1),t[1]||(t[1]=s("span",{class:"stat-label"},"Средний балл",-1))])])]),s("div",X,[s("div",Y,[t[2]||(t[2]=s("h3",null,"AI Анализ",-1)),s("button",{class:"primary",onClick:x,disabled:u.value||l.value===0},[m(p(B),{size:16,style:{"margin-right":"8px"}}),f(" "+n(u.value?"Анализ...":"Анализировать"),1)],8,Z)]),d.value?(r(),i("div",{key:0,class:"markdown-body",innerHTML:A(d.value)},null,8,ss)):(r(),i("p",ts,"Нажмите кнопку, чтобы получить советы от AI на основе вашей статистики."))]),s("div",es,[t[5]||(t[5]=s("h3",null,"История активности",-1)),s("div",as,[(r(!0),i(N,null,V(h.value,e=>(r(),i("div",{key:e.id,class:"history-item"},[s("div",ns,[s("span",os,n(b(e.date)),1),s("span",{class:M(["score",e.aiScore>=7?"text-success":"text-danger"])},n(e.aiScore)+"/10 ",3)]),s("div",is,[s("div",rs,[t[3]||(t[3]=s("strong",null,"Вопрос:",-1)),f(" "+n(w(e.questionId)),1)]),s("div",cs,[t[4]||(t[4]=s("strong",null,"Ваш ответ:",-1)),f(" "+n(e.userAnswer),1)])])]))),128)),h.value.length===0?(r(),i("p",ls,"История пуста.")):I("",!0)])])]))}}),ps=F(ds,[["__scopeId","data-v-5bc32b0d"]]);export{ps as default};
