import{c as z,d as F,r as m,w as P,a as u,F as L,b as Q,e as ue,o as i,f as s,g as E,h as A,i as D,u as g,t as _,j as b,n as O,_ as U,k as $,v as I,l as ce,s as ve,m as fe,p as V,q as pe,x as N}from"./index-CtsROhwf.js";import{T as W}from"./trash-2-CP9PiXpz.js";import{v as X}from"./v4-EwEgHOG0.js";const me=z("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const ye=z("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ge=z("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const be=z("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const Z=z("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const R=z("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),he={class:"tree-list"},ke=["onClick","onDragstart","onDrop"],Ce=["onClick"],_e={key:1,class:"spacer"},we={class:"node-name"},xe={class:"actions"},De=["onClick"],$e=["onClick"],Ie=["onClick"],ze={key:0,class:"children"},Te=F({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete","dragstart","drop"],setup(k,{emit:c}){const C=k,v=c,o=m(new Set),f=a=>{a.forEach(n=>{o.value.add(n.id),n.children&&n.children.length>0&&f(n.children)})};P(()=>C.nodes,a=>{o.value.size===0&&a.length>0&&f(a)},{immediate:!0});function h(a){o.value.has(a)?o.value.delete(a):o.value.add(a)}function y(a){v("select",a)}return(a,n)=>{const w=ue("CategoryTree",!0);return i(),u("ul",he,[(i(!0),u(L,null,Q(k.nodes,r=>(i(),u("li",{key:r.id,class:"tree-item"},[s("div",{class:O(["tree-content",{selected:k.selectedId===r.id}]),onClick:l=>y(r.id),draggable:"true",onDragstart:l=>v("dragstart",l,r),onDrop:l=>v("drop",l,r),onDragover:n[0]||(n[0]=D(()=>{},["prevent"]))},[r.children&&r.children.length>0?(i(),u("button",{key:0,class:"icon-btn toggle-btn",onClick:D(l=>h(r.id),["stop"])},[o.value.has(r.id)?(i(),A(g(me),{key:0,size:16})):(i(),A(g(ye),{key:1,size:16}))],8,Ce)):(i(),u("span",_e)),o.value.has(r.id)?(i(),A(g(ge),{key:2,size:18,class:"folder-icon"})):(i(),A(g(be),{key:3,size:18,class:"folder-icon"})),s("span",we,_(r.name),1),s("div",xe,[s("button",{class:"icon-btn",onClick:D(l=>v("add",r.id),["stop"]),title:"Add Subcategory"},[b(g(R),{size:14})],8,De),s("button",{class:"icon-btn",onClick:D(l=>v("edit",r),["stop"]),title:"Edit"},[b(g(Z),{size:14})],8,$e),s("button",{class:"icon-btn danger",onClick:D(l=>v("delete",r.id),["stop"]),title:"Delete"},[b(g(W),{size:14})],8,Ie)])],42,ke),o.value.has(r.id)&&r.children.length>0?(i(),u("div",ze,[b(w,{nodes:r.children,selectedId:k.selectedId,onSelect:n[1]||(n[1]=l=>v("select",l)),onAdd:n[2]||(n[2]=l=>v("add",l)),onEdit:n[3]||(n[3]=l=>v("edit",l)),onDelete:n[4]||(n[4]=l=>v("delete",l)),onDragstart:n[5]||(n[5]=(l,T)=>v("dragstart",l,T)),onDrop:n[6]||(n[6]=(l,T)=>v("drop",l,T))},null,8,["nodes","selectedId"])])):E("",!0)]))),128))])}}}),qe=U(Te,[["__scopeId","data-v-abd248e4"]]),Ae={class:"editor-card"},Se={class:"flex gap-4"},Me={class:"flex-1"},Ve={class:"flex-1"},Le={class:"flex justify-end gap-2 mt-4"},Qe=F({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(k,{emit:c}){const C=k,v=c,o=m({text:"",correctAnswer:"",difficulty:1,tags:[]}),f=m("");P(()=>C.question,y=>{y?(o.value={...y},f.value=y.tags.join(", ")):(o.value={text:"",correctAnswer:"",difficulty:1,tags:[]},f.value="")},{immediate:!0});function h(){const y=f.value.split(",").map(n=>n.trim()).filter(n=>n),a={id:o.value.id||X(),text:o.value.text||"",correctAnswer:o.value.correctAnswer||"",difficulty:o.value.difficulty||1,tags:y,categoryId:C.categoryId,nextReviewDate:o.value.nextReviewDate||Date.now(),interval:o.value.interval||0,repetitionFactor:o.value.repetitionFactor||2.5};v("save",a)}return(y,a)=>(i(),u("div",Ae,[s("h3",null,_(k.question?"Редактировать вопрос":"Новый вопрос"),1),s("form",{onSubmit:D(h,["prevent"]),class:"flex flex-col gap-4"},[s("div",null,[a[5]||(a[5]=s("label",{class:"block mb-2 font-bold"},"Вопрос (Markdown)",-1)),$(s("textarea",{"onUpdate:modelValue":a[0]||(a[0]=n=>o.value.text=n),rows:"4",required:""},null,512),[[I,o.value.text]])]),s("div",null,[a[6]||(a[6]=s("label",{class:"block mb-2 font-bold"},"Правильный ответ (Markdown)",-1)),$(s("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>o.value.correctAnswer=n),rows:"4",required:""},null,512),[[I,o.value.correctAnswer]])]),s("div",Se,[s("div",Me,[a[7]||(a[7]=s("label",{class:"block mb-2 font-bold"},"Сложность (1-5)",-1)),$(s("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>o.value.difficulty=n),type:"number",min:"1",max:"5",required:""},null,512),[[I,o.value.difficulty,void 0,{number:!0}]])]),s("div",Ve,[a[8]||(a[8]=s("label",{class:"block mb-2 font-bold"},"Теги (через запятую)",-1)),$(s("input",{"onUpdate:modelValue":a[3]||(a[3]=n=>f.value=n),type:"text",placeholder:"js, vue, basics"},null,512),[[I,f.value]])])]),s("div",Le,[s("button",{type:"button",onClick:a[4]||(a[4]=n=>v("cancel"))},"Отмена"),a[9]||(a[9]=s("button",{type:"submit",class:"primary"},"Сохранить",-1))])],32)]))}}),Ee=U(Qe,[["__scopeId","data-v-12c33e65"]]),Re={class:"sidebar-header"},Fe={class:"search-box mb-2"},Ue={class:"tree-container"},je={class:"questions-main"},Be={key:0},He={class:"main-header"},Ne={class:"count"},Pe={class:"header-actions"},Oe={key:0,class:"mt-4"},We={key:1,class:"questions-list mt-4"},Xe=["onDragstart"],Ze={class:"q-text"},Ge={class:"q-meta"},Je={class:"q-actions"},Ke=["onClick"],Ye=["onClick"],et={key:0,class:"empty-state"},tt={key:1,class:"empty-state-main"},st=F({__name:"LibraryView",setup(k){const c=ce(),{categoriesTree:C,questions:v}=ve(c),o=m(null),f=m(!1),h=m(null),y=m(300),a=m(!1),n=m(""),w=m("");fe(async()=>{c.isLoaded||await c.loadData()});const r=V(()=>{if(!o.value)return[];let t=v.value.filter(e=>e.categoryId===o.value);if(w.value.trim()){const e=w.value.toLowerCase();t=t.filter(d=>d.text.toLowerCase().includes(e)||d.tags.some(p=>p.toLowerCase().includes(e)))}return t}),l=V(()=>{if(!n.value.trim())return C.value;const t=n.value.toLowerCase(),e=d=>d.reduce((p,x)=>{const M=x.name.toLowerCase().includes(t),H=e(x.children||[]);return(M||H.length>0)&&p.push({...x,children:H}),p},[]);return e(C.value)}),T=V(()=>{if(!o.value)return"";const t=c.categories.find(e=>e.id===o.value);return t?t.name:""});function G(t){o.value=t,f.value=!1}async function j(t){const e=prompt("Введите название категории:");e&&await c.addCategory({id:X(),name:e,parentId:t})}async function J(t){const e=prompt("Новое название:",t.name);!e||e===t.name||await c.updateCategory({...t,name:e})}async function K(t){confirm("Удалить категорию и все вложенные вопросы?")&&(await c.removeCategory(t),o.value===t&&(o.value=null))}function Y(){h.value=null,f.value=!0}function ee(t){h.value=t,f.value=!0}async function te(t){h.value?await c.updateQuestion(t):await c.addQuestion(t),f.value=!1,h.value=null}async function se(t){confirm("Удалить вопрос?")&&await c.removeQuestion(t)}const S=m(null);function ae(t,e){S.value=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.id))}const q=m(null);function ne(t,e){q.value=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.id),t.dataTransfer.setData("type","question"))}async function oe(t,e){if(t.dataTransfer?.getData("type")==="question"&&q.value){q.value.categoryId!==e.id&&await c.updateQuestion({...q.value,categoryId:e.id}),q.value=null;return}const p=S.value?.id;if(!p||p===e.id)return;const x=c.categories.find(M=>M.id===p);x&&await c.updateCategory({...x,parentId:e.id}),S.value=null}function le(t){return["Легкий","Простой","Средний","Сложный","Эксперт"][t-1]||t}function ie(t){return t<=2?"diff-easy":t===3?"diff-medium":"diff-hard"}function re(){a.value=!0}function B(){a.value=!1}function de(t){if(!a.value)return;const e=t.clientX-250-20;e>200&&e<600&&(y.value=e)}return(t,e)=>(i(),u("div",{class:"library-layout",onMousemove:de,onMouseup:B,onMouseleave:B},[s("aside",{class:"categories-sidebar",style:pe({width:y.value+"px"})},[s("div",Re,[e[4]||(e[4]=s("h2",null,"Категории",-1)),s("button",{class:"icon-btn",onClick:e[0]||(e[0]=d=>j(null)),title:"Add Root Category"},[b(g(R),{size:20})])]),s("div",Fe,[$(s("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>n.value=d),type:"text",placeholder:"Поиск категорий...",class:"search-input"},null,512),[[I,n.value]])]),s("div",Ue,[b(qe,{nodes:l.value,selectedId:o.value,onSelect:G,onAdd:j,onEdit:J,onDelete:K,onDragstart:ae,onDrop:oe},null,8,["nodes","selectedId"])])],4),s("div",{class:"resizer",onMousedown:re},null,32),s("main",je,[o.value?(i(),u("div",Be,[s("div",He,[s("h2",null,[N(_(T.value)+" ",1),s("span",Ne,"("+_(r.value.length)+")",1)]),s("div",Pe,[$(s("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>w.value=d),type:"text",placeholder:"Поиск вопросов...",class:"search-input question-search"},null,512),[[I,w.value]]),f.value?E("",!0):(i(),u("button",{key:0,class:"primary",onClick:Y},[b(g(R),{size:16,style:{"margin-right":"8px"}}),e[5]||(e[5]=N(" Добавить вопрос ",-1))]))])]),f.value?(i(),u("div",Oe,[b(Ee,{question:h.value,categoryId:o.value,onSave:te,onCancel:e[3]||(e[3]=d=>f.value=!1)},null,8,["question","categoryId"])])):(i(),u("div",We,[(i(!0),u(L,null,Q(r.value,d=>(i(),u("div",{key:d.id,class:"question-card"},[s("div",{class:"q-content",draggable:"true",onDragstart:p=>ne(p,d)},[s("div",Ze,_(d.text),1),s("div",Ge,[s("span",{class:O(["badge",ie(d.difficulty)])},_(le(d.difficulty)),3),(i(!0),u(L,null,Q(d.tags,p=>(i(),u("span",{key:p,class:"badge tag"},_(p),1))),128))])],40,Xe),s("div",Je,[s("button",{class:"icon-btn",onClick:p=>ee(d)},[b(g(Z),{size:16})],8,Ke),s("button",{class:"icon-btn danger",onClick:p=>se(d.id)},[b(g(W),{size:16})],8,Ye)])]))),128)),r.value.length===0?(i(),u("p",et," В этой категории пока нет вопросов. ")):E("",!0)]))])):(i(),u("div",tt,[...e[6]||(e[6]=[s("p",null,"Выберите категорию слева, чтобы управлять вопросами.",-1)])]))])],32))}}),lt=U(st,[["__scopeId","data-v-c607e4bc"]]);export{lt as default};
