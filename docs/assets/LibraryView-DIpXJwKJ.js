import{c as I,d as R,r as y,a as c,F as M,b as V,e as de,o as r,f as s,g as L,h as z,w as x,u as b,t as _,i as k,n as H,_ as E,j as ue,k as D,v as $,l as ce,s as ve,m as fe,p as S,q as pe,x as B}from"./index-508QKKWx.js";import{T as N}from"./trash-2-CjTHNNcQ.js";import{v as P}from"./v4-EwEgHOG0.js";const me=I("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const ye=I("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ge=I("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const be=I("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const O=I("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const Q=I("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ke={class:"tree-list"},he=["onClick","onDragstart","onDrop"],Ce=["onClick"],_e={key:1,class:"spacer"},we={class:"node-name"},xe={class:"actions"},De=["onClick"],$e=["onClick"],Ie=["onClick"],Te={key:0,class:"children"},ze=R({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete","dragstart","drop"],setup(h,{emit:v}){const u=v,g=y(new Set);function n(m){g.value.has(m)?g.value.delete(m):g.value.add(m)}function f(m){u("select",m)}return(m,i)=>{const o=de("CategoryTree",!0);return r(),c("ul",ke,[(r(!0),c(M,null,V(h.nodes,a=>(r(),c("li",{key:a.id,class:"tree-item"},[s("div",{class:H(["tree-content",{selected:h.selectedId===a.id}]),onClick:l=>f(a.id),draggable:"true",onDragstart:l=>u("dragstart",l,a),onDrop:l=>u("drop",l,a),onDragover:i[0]||(i[0]=x(()=>{},["prevent"]))},[a.children&&a.children.length>0?(r(),c("button",{key:0,class:"icon-btn toggle-btn",onClick:x(l=>n(a.id),["stop"])},[g.value.has(a.id)?(r(),z(b(me),{key:0,size:16})):(r(),z(b(ye),{key:1,size:16}))],8,Ce)):(r(),c("span",_e)),g.value.has(a.id)?(r(),z(b(ge),{key:2,size:18,class:"folder-icon"})):(r(),z(b(be),{key:3,size:18,class:"folder-icon"})),s("span",we,_(a.name),1),s("div",xe,[s("button",{class:"icon-btn",onClick:x(l=>u("add",a.id),["stop"]),title:"Add Subcategory"},[k(b(Q),{size:14})],8,De),s("button",{class:"icon-btn",onClick:x(l=>u("edit",a),["stop"]),title:"Edit"},[k(b(O),{size:14})],8,$e),s("button",{class:"icon-btn danger",onClick:x(l=>u("delete",a.id),["stop"]),title:"Delete"},[k(b(N),{size:14})],8,Ie)])],42,he),g.value.has(a.id)&&a.children.length>0?(r(),c("div",Te,[k(o,{nodes:a.children,selectedId:h.selectedId,onSelect:i[1]||(i[1]=l=>u("select",l)),onAdd:i[2]||(i[2]=l=>u("add",l)),onEdit:i[3]||(i[3]=l=>u("edit",l)),onDelete:i[4]||(i[4]=l=>u("delete",l)),onDragstart:i[5]||(i[5]=(l,C)=>u("dragstart",l,C)),onDrop:i[6]||(i[6]=(l,C)=>u("drop",l,C))},null,8,["nodes","selectedId"])])):L("",!0)]))),128))])}}}),qe=E(ze,[["__scopeId","data-v-b71eabcd"]]),Ae={class:"editor-card"},Se={class:"flex gap-4"},Me={class:"flex-1"},Ve={class:"flex-1"},Le={class:"flex justify-end gap-2 mt-4"},Qe=R({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(h,{emit:v}){const u=h,g=v,n=y({text:"",correctAnswer:"",difficulty:1,tags:[]}),f=y("");ue(()=>u.question,i=>{i?(n.value={...i},f.value=i.tags.join(", ")):(n.value={text:"",correctAnswer:"",difficulty:1,tags:[]},f.value="")},{immediate:!0});function m(){const i=f.value.split(",").map(a=>a.trim()).filter(a=>a),o={id:n.value.id||P(),text:n.value.text||"",correctAnswer:n.value.correctAnswer||"",difficulty:n.value.difficulty||1,tags:i,categoryId:u.categoryId,nextReviewDate:n.value.nextReviewDate||Date.now(),interval:n.value.interval||0,repetitionFactor:n.value.repetitionFactor||2.5};g("save",o)}return(i,o)=>(r(),c("div",Ae,[s("h3",null,_(h.question?"Редактировать вопрос":"Новый вопрос"),1),s("form",{onSubmit:x(m,["prevent"]),class:"flex flex-col gap-4"},[s("div",null,[o[5]||(o[5]=s("label",{class:"block mb-2 font-bold"},"Вопрос (Markdown)",-1)),D(s("textarea",{"onUpdate:modelValue":o[0]||(o[0]=a=>n.value.text=a),rows:"4",required:""},null,512),[[$,n.value.text]])]),s("div",null,[o[6]||(o[6]=s("label",{class:"block mb-2 font-bold"},"Правильный ответ (Markdown)",-1)),D(s("textarea",{"onUpdate:modelValue":o[1]||(o[1]=a=>n.value.correctAnswer=a),rows:"4",required:""},null,512),[[$,n.value.correctAnswer]])]),s("div",Se,[s("div",Me,[o[7]||(o[7]=s("label",{class:"block mb-2 font-bold"},"Сложность (1-5)",-1)),D(s("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>n.value.difficulty=a),type:"number",min:"1",max:"5",required:""},null,512),[[$,n.value.difficulty,void 0,{number:!0}]])]),s("div",Ve,[o[8]||(o[8]=s("label",{class:"block mb-2 font-bold"},"Теги (через запятую)",-1)),D(s("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>f.value=a),type:"text",placeholder:"js, vue, basics"},null,512),[[$,f.value]])])]),s("div",Le,[s("button",{type:"button",onClick:o[4]||(o[4]=a=>g("cancel"))},"Отмена"),o[9]||(o[9]=s("button",{type:"submit",class:"primary"},"Сохранить",-1))])],32)]))}}),Re=E(Qe,[["__scopeId","data-v-12c33e65"]]),Ee={class:"sidebar-header"},Fe={class:"search-box mb-2"},Ue={class:"tree-container"},je={class:"questions-main"},Be={key:0},He={class:"main-header"},Ne={class:"count"},Pe={class:"header-actions"},Oe={key:0,class:"mt-4"},We={key:1,class:"questions-list mt-4"},Xe=["onDragstart"],Ze={class:"q-text"},Ge={class:"q-meta"},Je={class:"q-actions"},Ke=["onClick"],Ye=["onClick"],et={key:0,class:"empty-state"},tt={key:1,class:"empty-state-main"},st=R({__name:"LibraryView",setup(h){const v=ce(),{categoriesTree:u,questions:g}=ve(v),n=y(null),f=y(!1),m=y(null),i=y(300),o=y(!1),a=y(""),l=y("");fe(async()=>{v.isLoaded||await v.loadData()});const C=S(()=>{if(!n.value)return[];let t=g.value.filter(e=>e.categoryId===n.value);if(l.value.trim()){const e=l.value.toLowerCase();t=t.filter(d=>d.text.toLowerCase().includes(e)||d.tags.some(p=>p.toLowerCase().includes(e)))}return t}),W=S(()=>{if(!a.value.trim())return u.value;const t=a.value.toLowerCase(),e=d=>d.reduce((p,w)=>{const A=w.name.toLowerCase().includes(t),j=e(w.children||[]);return(A||j.length>0)&&p.push({...w,children:j}),p},[]);return e(u.value)}),X=S(()=>{if(!n.value)return"";const t=v.categories.find(e=>e.id===n.value);return t?t.name:""});function Z(t){n.value=t,f.value=!1}async function F(t){const e=prompt("Введите название категории:");e&&await v.addCategory({id:P(),name:e,parentId:t})}async function G(t){const e=prompt("Новое название:",t.name);!e||e===t.name||await v.updateCategory({...t,name:e})}async function J(t){confirm("Удалить категорию и все вложенные вопросы?")&&(await v.removeCategory(t),n.value===t&&(n.value=null))}function K(){m.value=null,f.value=!0}function Y(t){m.value=t,f.value=!0}async function ee(t){m.value?await v.updateQuestion(t):await v.addQuestion(t),f.value=!1,m.value=null}async function te(t){confirm("Удалить вопрос?")&&await v.removeQuestion(t)}const q=y(null);function se(t,e){q.value=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.id))}const T=y(null);function ae(t,e){T.value=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.id),t.dataTransfer.setData("type","question"))}async function ne(t,e){if(t.dataTransfer?.getData("type")==="question"&&T.value){T.value.categoryId!==e.id&&await v.updateQuestion({...T.value,categoryId:e.id}),T.value=null;return}const p=q.value?.id;if(!p||p===e.id)return;const w=v.categories.find(A=>A.id===p);w&&await v.updateCategory({...w,parentId:e.id}),q.value=null}function oe(t){return["Легкий","Простой","Средний","Сложный","Эксперт"][t-1]||t}function le(t){return t<=2?"diff-easy":t===3?"diff-medium":"diff-hard"}function ie(){o.value=!0}function U(){o.value=!1}function re(t){if(!o.value)return;const e=t.clientX-250-20;e>200&&e<600&&(i.value=e)}return(t,e)=>(r(),c("div",{class:"library-layout",onMousemove:re,onMouseup:U,onMouseleave:U},[s("aside",{class:"categories-sidebar",style:pe({width:i.value+"px"})},[s("div",Ee,[e[4]||(e[4]=s("h2",null,"Категории",-1)),s("button",{class:"icon-btn",onClick:e[0]||(e[0]=d=>F(null)),title:"Add Root Category"},[k(b(Q),{size:20})])]),s("div",Fe,[D(s("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>a.value=d),type:"text",placeholder:"Поиск категорий...",class:"search-input"},null,512),[[$,a.value]])]),s("div",Ue,[k(qe,{nodes:W.value,selectedId:n.value,onSelect:Z,onAdd:F,onEdit:G,onDelete:J,onDragstart:se,onDrop:ne},null,8,["nodes","selectedId"])])],4),s("div",{class:"resizer",onMousedown:ie},null,32),s("main",je,[n.value?(r(),c("div",Be,[s("div",He,[s("h2",null,[B(_(X.value)+" ",1),s("span",Ne,"("+_(C.value.length)+")",1)]),s("div",Pe,[D(s("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>l.value=d),type:"text",placeholder:"Поиск вопросов...",class:"search-input question-search"},null,512),[[$,l.value]]),f.value?L("",!0):(r(),c("button",{key:0,class:"primary",onClick:K},[k(b(Q),{size:16,style:{"margin-right":"8px"}}),e[5]||(e[5]=B(" Добавить вопрос ",-1))]))])]),f.value?(r(),c("div",Oe,[k(Re,{question:m.value,categoryId:n.value,onSave:ee,onCancel:e[3]||(e[3]=d=>f.value=!1)},null,8,["question","categoryId"])])):(r(),c("div",We,[(r(!0),c(M,null,V(C.value,d=>(r(),c("div",{key:d.id,class:"question-card"},[s("div",{class:"q-content",draggable:"true",onDragstart:p=>ae(p,d)},[s("div",Ze,_(d.text),1),s("div",Ge,[s("span",{class:H(["badge",le(d.difficulty)])},_(oe(d.difficulty)),3),(r(!0),c(M,null,V(d.tags,p=>(r(),c("span",{key:p,class:"badge tag"},_(p),1))),128))])],40,Xe),s("div",Je,[s("button",{class:"icon-btn",onClick:p=>Y(d)},[k(b(O),{size:16})],8,Ke),s("button",{class:"icon-btn danger",onClick:p=>te(d.id)},[k(b(N),{size:16})],8,Ye)])]))),128)),C.value.length===0?(r(),c("p",et," В этой категории пока нет вопросов. ")):L("",!0)]))])):(r(),c("div",tt,[...e[6]||(e[6]=[s("p",null,"Выберите категорию слева, чтобы управлять вопросами.",-1)])]))])],32))}}),lt=E(st,[["__scopeId","data-v-c607e4bc"]]);export{lt as default};
