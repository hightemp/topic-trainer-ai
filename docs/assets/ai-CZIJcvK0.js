import{K as p}from"./index-BGBJc1oC.js";class l{get apiKey(){return p().settings.openRouterKey}get model(){return p().settings.openRouterModel||"google/gemini-2.0-flash-exp"}get tools(){return[{type:"function",function:{name:"create_category",description:"Create a new category for questions",parameters:{type:"object",properties:{name:{type:"string",description:"Name of the category"},parentId:{type:"string",description:"ID of the parent category (optional)",nullable:!0}},required:["name"]}}},{type:"function",function:{name:"create_question",description:"Create a new question",parameters:{type:"object",properties:{text:{type:"string",description:"The question text (Markdown supported)"},correctAnswer:{type:"string",description:"The correct answer (Markdown supported)"},difficulty:{type:"number",description:"Difficulty level 1-5"},tags:{type:"array",items:{type:"string"},description:"List of tags"},categoryId:{type:"string",description:"ID of the category this question belongs to"}},required:["text","correctAnswer","difficulty","categoryId"]}}},{type:"function",function:{name:"get_categories",description:"Get list of existing categories to find IDs",parameters:{type:"object",properties:{}}}},{type:"function",function:{name:"update_category",description:"Update an existing category",parameters:{type:"object",properties:{id:{type:"string",description:"ID of the category to update"},name:{type:"string",description:"New name (optional)"},parentId:{type:"string",description:"New parent ID (optional)",nullable:!0}},required:["id"]}}},{type:"function",function:{name:"delete_category",description:"Delete a category",parameters:{type:"object",properties:{id:{type:"string",description:"ID of the category to delete"}},required:["id"]}}},{type:"function",function:{name:"get_questions",description:"Get list of questions (optionally filtered by category)",parameters:{type:"object",properties:{categoryId:{type:"string",description:"Filter by category ID (optional)"},limit:{type:"number",description:"Max number of questions to return (default 20)"}}}}},{type:"function",function:{name:"update_question",description:"Update an existing question",parameters:{type:"object",properties:{id:{type:"string",description:"ID of the question to update"},text:{type:"string",description:"New text (optional)"},correctAnswer:{type:"string",description:"New correct answer (optional)"},difficulty:{type:"number",description:"New difficulty (optional)"},tags:{type:"array",items:{type:"string"},description:"New tags (optional)"},categoryId:{type:"string",description:"New category ID (optional)"}},required:["id"]}}},{type:"function",function:{name:"delete_question",description:"Delete a question",parameters:{type:"object",properties:{id:{type:"string",description:"ID of the question to delete"}},required:["id"]}}}]}async chat(r,i,n){if(!this.apiKey)throw new Error("API Key not configured");const e=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"Topic Trainer AI"},body:JSON.stringify({model:this.model,messages:r,tools:this.tools}),signal:n});if(!e.ok){const o=await e.json();throw new Error(o.error?.message||"AI Request failed")}const t=(await e.json()).choices[0].message;if(t.tool_calls){const o=[];o.push(t);for(const s of t.tool_calls){const u=JSON.parse(s.function.arguments);let c;try{c=await i(s.function.name,u)}catch(y){c={error:y.message}}o.push({role:"tool",tool_call_id:s.id,name:s.function.name,content:JSON.stringify(c)})}return this.chat([...r,...o],i,n)}return t}async evaluateAnswer(r,i,n){const e=`
      Question: ${r}
      Correct Answer: ${i}
      User Answer: ${n}

      Evaluate the user's answer. 
      1. Give a score from 0 to 10 (0 = completely wrong, 10 = perfect).
      2. Provide brief feedback explaining the score and correcting any mistakes.
      
      Return JSON: { "score": number, "feedback": "string" }
    `,a=await(await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"Topic Trainer AI"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:e}],response_format:{type:"json_object"}})})).json();try{return JSON.parse(a.choices[0].message.content)}catch{return console.error("Failed to parse AI evaluation",a),{score:0,feedback:"Error parsing AI response"}}}}const m=new l;export{m as a};
