import{c as x,d as $,r as u,l as P,m as U,a as o,f as s,F as D,b as T,u as g,i as F,p as L,g as w,q as j,t as d,k as G,v as J,n as b,h as I,x as K,o as l,_ as O}from"./index-kWCJmzC_.js";import{u as W}from"./data-DK_uuTaL.js";import{a as X,d as Y}from"./marked.esm-Czu7L_uv.js";import{v as Z}from"./v4-EwEgHOG0.js";const ee=x("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const te=x("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const se=x("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const ae=x("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),ne={class:"container"},le={key:0,class:"setup-screen"},oe={class:"card mt-4"},ie={class:"tags-cloud"},re=["onClick"],ce={class:"card mt-4"},ue={class:"tags-cloud"},de=["onClick"],ve={class:"actions mt-4"},pe={key:1,class:"training-screen"},fe={class:"progress-bar"},me={class:"question-header"},he={key:0,class:"timer"},ke={key:0,class:"card question-card"},_e=["innerHTML"],ye={class:"answer-section mt-4"},ge=["disabled"],we={class:"feedback-header"},be={class:"score"},xe={key:0,class:"correct-answer mt-4"},Ce=["innerHTML"],Se={class:"actions mt-4"},De=["disabled"],Te={key:2,class:"result-screen"},Me={class:"card mt-4"},Ae={class:"result-header"},ze={class:"text-sm"},Fe=$({__name:"TrainerView",setup(Le){const p=W(),k=u("setup"),f=u(new Set),m=u(new Set),V=u(!0),r=u([]),c=u(0),h=u(""),_=u(!1),M=u(0),v=u(null),C=u([]);P(async()=>{p.isLoaded||await p.loadData()});const E=U(()=>{const a=new Set;return p.questions.forEach(t=>t.tags.forEach(e=>a.add(e))),Array.from(a)});function B(a){f.value.has(a)?f.value.delete(a):f.value.add(a)}function Q(a){m.value.has(a)?m.value.delete(a):m.value.add(a)}function R(){const a=n=>{const i=p.categories.filter(y=>y.parentId===n);let S=i.map(y=>y.id);return i.forEach(y=>{S=[...S,...a(y.id)]}),S},t=new Set;f.value.forEach(n=>{t.add(n),a(n).forEach(i=>t.add(i))});let e=p.questions.filter(n=>!(f.value.size>0&&!t.has(n.categoryId)||m.value.size>0&&!n.tags.some(i=>m.value.has(i))));if(e.sort((n,i)=>n.nextReviewDate-i.nextReviewDate),r.value=e.slice(0,20),r.value.length===0){alert("Нет вопросов, соответствующих критериям.");return}c.value=0,C.value=[],k.value="training",A()}function A(){h.value="",v.value=null,M.value=Date.now()}async function q(){if(!h.value.trim())return;_.value=!0;const a=r.value[c.value];if(!a)return;const t=(Date.now()-M.value)/1e3;try{const e=await X.evaluateAnswer(a.text,a.correctAnswer,h.value);v.value=e;const n=Math.round(e.score/2);H(a,n);const i={id:Z(),questionId:a.id,date:Date.now(),userAnswer:h.value,aiScore:e.score,aiFeedback:e.feedback,duration:t};await K.saveAttempt(i),C.value.push(i)}catch(e){console.error(e),alert("Ошибка проверки ответа")}finally{_.value=!1}}function H(a,t){let e=a.repetitionFactor,n=a.interval;t<3?n=1:(n===0?n=1:n===1?n=6:n=Math.round(n*e),e=e+(.1-(5-t)*(.08+(5-t)*.02)),e<1.3&&(e=1.3));const i=Date.now()+n*24*60*60*1e3;p.updateQuestion({...a,interval:n,repetitionFactor:e,nextReviewDate:i})}function N(){c.value<r.value.length-1?(c.value++,A()):k.value="result"}function z(a){return Y(a||"")}return(a,t)=>(l(),o("div",ne,[k.value==="setup"?(l(),o("div",le,[t[5]||(t[5]=s("h1",null,"Настройка тренировки",-1)),s("div",oe,[t[2]||(t[2]=s("h3",null,"Категории",-1)),s("div",ie,[(l(!0),o(D,null,T(g(p).categories,e=>(l(),o("button",{key:e.id,class:b(["chip",{active:f.value.has(e.id)}]),onClick:n=>B(e.id)},d(e.name),11,re))),128))])]),s("div",ce,[t[3]||(t[3]=s("h3",null,"Теги",-1)),s("div",ue,[(l(!0),o(D,null,T(E.value,e=>(l(),o("button",{key:e,class:b(["chip",{active:m.value.has(e)}]),onClick:n=>Q(e)},d(e),11,de))),128))])]),s("div",ve,[s("button",{class:"primary large",onClick:R},[F(g(ae),{size:24}),t[4]||(t[4]=L(" Начать ",-1))])])])):k.value==="training"?(l(),o("div",pe,[s("div",fe,[s("div",{class:"progress-fill",style:j({width:`${(c.value+1)/r.value.length*100}%`})},null,4)]),s("div",me,[s("span",null,"Вопрос "+d(c.value+1)+" из "+d(r.value.length),1),V.value?(l(),o("span",he,[F(g(se),{size:16}),t[6]||(t[6]=L(" ...",-1))])):w("",!0)]),r.value[c.value]?(l(),o("div",ke,[s("div",{class:"markdown-body",innerHTML:z(r.value[c.value]?.text||"")},null,8,_e)])):w("",!0),s("div",ye,[G(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),rows:"6",placeholder:"Ваш ответ...",disabled:!!v.value||_.value},null,8,ge),[[J,h.value]])]),v.value?(l(),o("div",{key:1,class:b(["feedback-section mt-4",v.value.score>=7?"good":"bad"])},[s("div",we,[v.value.score>=7?(l(),I(g(te),{key:0,size:24})):(l(),I(g(ee),{key:1,size:24})),s("span",be,"Оценка: "+d(v.value.score)+"/10",1)]),s("p",null,d(v.value.feedback),1),r.value[c.value]?(l(),o("div",xe,[t[7]||(t[7]=s("strong",null,"Правильный ответ:",-1)),s("div",{innerHTML:z(r.value[c.value]?.correctAnswer||"")},null,8,Ce)])):w("",!0)],2)):w("",!0),s("div",Se,[v.value?(l(),o("button",{key:1,class:"primary",onClick:N},d(c.value<r.value.length-1?"Следующий вопрос":"Завершить"),1)):(l(),o("button",{key:0,class:"primary",onClick:q,disabled:_.value},d(_.value?"Проверка...":"Ответить"),9,De))])])):(l(),o("div",Te,[t[8]||(t[8]=s("h1",null,"Результаты тренировки",-1)),s("div",Me,[(l(!0),o(D,null,T(C.value,(e,n)=>(l(),o("div",{key:e.id,class:"result-item"},[s("div",Ae,[s("strong",null,"Вопрос "+d(n+1),1),s("span",{class:b(e.aiScore>=7?"text-success":"text-danger")},d(e.aiScore)+"/10",3)]),s("p",ze,d(e.aiFeedback),1)]))),128))]),s("button",{class:"primary mt-4",onClick:t[1]||(t[1]=e=>k.value="setup")},"Новая тренировка")]))]))}}),Qe=O(Fe,[["__scopeId","data-v-c60baed4"]]);export{Qe as default};
