import{c as h,d as V,l as B,r as y,m as Q,w as q,z as L,a as c,f as n,g,F as w,b,j as p,u as d,t as C,i as I,k as N,v as D,A as H,B as F,o as r,n as U,h as x,_ as J}from"./index-BGBJc1oC.js";import{a as K}from"./ai-CZIJcvK0.js";import{a as O}from"./markdown-DbG5hxBn.js";import{T as j}from"./trash-2-Dyqzaf1J.js";import{v as M}from"./v4-EwEgHOG0.js";const S=h("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const E=h("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const $=h("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const G=h("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const P=h("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),R={class:"chat-layout"},W={class:"avatar"},X={class:"bubble"},Y=["innerHTML"],Z={key:1,class:"tool-calls"},ee={key:0,class:"message assistant"},te={class:"avatar"},ae={class:"bubble loading"},se={class:"input-area"},oe={class:"toolbar"},ne={class:"toolbar-info"},re={class:"message-count"},le=["disabled","onKeydown"],ie=["disabled"],ce={name:"ChatView"},ue=V({...ce,setup(de){const i=B(),s=y([]),v=y(""),f=y(!1),_=y(null),u=y(null);Q(()=>{const a=localStorage.getItem("chat-messages");if(a)try{s.value=JSON.parse(a)}catch(t){console.error("Failed to load chat messages:",t),s.value.push({role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."})}else s.value.push({role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."})}),q(s,a=>{localStorage.setItem("chat-messages",JSON.stringify(a))},{deep:!0});async function m(){await F(),_.value&&(_.value.scrollTop=_.value.scrollHeight)}async function z(a,t){if(console.log("Tool Call:",a,t),a==="create_category"){const e=M();return await i.addCategory({id:e,name:t.name,parentId:t.parentId||null}),{success:!0,id:e,message:`Category "${t.name}" created.`}}if(a==="create_question"){const e=M();return await i.addQuestion({id:e,text:t.text,correctAnswer:t.correctAnswer,difficulty:t.difficulty,tags:t.tags||[],categoryId:t.categoryId,nextReviewDate:Date.now(),interval:0,repetitionFactor:2.5}),{success:!0,id:e,message:"Question created."}}if(a==="get_categories")return i.categories.map(e=>({id:e.id,name:e.name,parentId:e.parentId}));if(a==="update_category"){const e=i.categories.find(o=>o.id===t.id);return e?(await i.updateCategory({...e,name:t.name||e.name,parentId:t.parentId!==void 0?t.parentId:e.parentId}),{success:!0,message:"Category updated."}):{error:"Category not found"}}if(a==="delete_category")return await i.removeCategory(t.id),{success:!0,message:"Category deleted."};if(a==="get_questions"){let e=i.questions;t.categoryId&&(e=e.filter(l=>l.categoryId===t.categoryId));const o=t.limit||20;return e.slice(0,o).map(l=>({id:l.id,text:l.text,correctAnswer:l.correctAnswer,difficulty:l.difficulty,tags:l.tags,categoryId:l.categoryId}))}if(a==="update_question"){const e=i.questions.find(o=>o.id===t.id);return e?(await i.updateQuestion({...e,text:t.text||e.text,correctAnswer:t.correctAnswer||e.correctAnswer,difficulty:t.difficulty||e.difficulty,tags:t.tags||e.tags,categoryId:t.categoryId||e.categoryId}),{success:!0,message:"Question updated."}):{error:"Question not found"}}return a==="delete_question"?(await i.removeQuestion(t.id),{success:!0,message:"Question deleted."}):{error:"Unknown tool"}}function A(){u.value&&(u.value.abort(),u.value=null,f.value=!1,s.value.push({role:"assistant",content:"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."}),m())}function T(){confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?")&&(s.value=[{role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."}],localStorage.setItem("chat-messages",JSON.stringify(s.value)))}async function k(){if(!v.value.trim()||f.value)return;const a={role:"user",content:v.value};s.value.push(a),v.value="",f.value=!0,m(),u.value=new AbortController;try{const t=s.value.map(o=>({role:o.role,content:o.content,tool_calls:o.tool_calls,tool_call_id:o.tool_call_id,name:o.name})),e=await K.chat(t,z,u.value.signal);e.content?s.value.push({role:"assistant",content:e.content}):e.tool_calls&&s.value.push({role:"assistant",content:e.content||"–ì–æ—Ç–æ–≤–æ."})}catch(t){t.name==="AbortError"||s.value.push({role:"assistant",content:`–û—à–∏–±–∫–∞: ${t.message}`})}finally{u.value&&(f.value=!1,u.value=null),m()}}return L(()=>{u.value&&u.value.abort()}),(a,t)=>(r(),c("div",R,[n("div",{class:"chat-container",ref_key:"chatContainer",ref:_},[(r(!0),c(w,null,b(s.value,(e,o)=>(r(),c("div",{key:o,class:U(["message",e.role])},[n("div",W,[e.role==="assistant"?(r(),x(d(S),{key:0,size:24})):(r(),x(d(P),{key:1,size:24}))]),n("div",X,[e.content?(r(),c("div",{key:0,innerHTML:d(O)(e.content),class:"markdown-content"},null,8,Y)):g("",!0),e.tool_calls?(r(),c("div",Z,[(r(!0),c(w,null,b(e.tool_calls,l=>(r(),c("div",{key:l.id,class:"tool-badge"}," üõ†Ô∏è "+C(l.function.name),1))),128))])):g("",!0)])],2))),128)),f.value?(r(),c("div",ee,[n("div",te,[p(d(S),{size:24})]),n("div",ae,[p(d(E),{size:20,class:"spin"})])])):g("",!0)],512),n("div",se,[n("div",oe,[n("div",ne,[n("span",re,C(s.value.length)+" —Å–æ–æ–±—â–µ–Ω–∏–π",1)]),n("button",{type:"button",onClick:T,class:"clear-btn",title:"–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"},[p(d(j),{size:18}),t[1]||(t[1]=n("span",null,"–û—á–∏—Å—Ç–∏—Ç—å",-1))])]),n("form",{onSubmit:I(k,["prevent"]),class:"input-form"},[N(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ Vue 3 Composition API...",disabled:f.value,onKeydown:H(I(k,["exact","prevent"]),["enter"]),rows:"1",class:"chat-input"},null,40,le),[[D,v.value]]),f.value?(r(),c("button",{key:0,type:"button",onClick:A,class:"stop-btn",title:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"},[p(d(G),{size:20,fill:"currentColor"})])):(r(),c("button",{key:1,type:"submit",disabled:!v.value.trim()},[p(d($),{size:20})],8,ie))],32)])]))}}),_e=J(ue,[["__scopeId","data-v-ebe0c9f1"]]);export{_e as default};
