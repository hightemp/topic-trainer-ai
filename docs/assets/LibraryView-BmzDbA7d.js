import{u as U}from"./data-CTdArvzf.js";import{c as h,d as V,r as b,a as d,F as q,b as z,e as P,o as a,f as e,g as A,h as x,w as C,u as f,t as g,i as y,n as O,_ as T,j as Z,k as $,v as I,s as G,l as J,m as Q,p as S}from"./index-CbXKj1MZ.js";import{T as M}from"./trash-2-arsUuCRc.js";import{v as E}from"./v4-EwEgHOG0.js";const K=h("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const W=h("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const X=h("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const Y=h("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const L=h("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const D=h("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ee={class:"tree-list"},te=["onClick"],se=["onClick"],ne={key:1,class:"spacer"},oe={class:"node-name"},ae={class:"actions"},le=["onClick"],ie=["onClick"],de=["onClick"],re={key:0,class:"children"},ue=V({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete"],setup(k,{emit:c}){const m=c,p=b(new Set);function s(v){p.value.has(v)?p.value.delete(v):p.value.add(v)}function r(v){m("select",v)}return(v,l)=>{const n=P("CategoryTree",!0);return a(),d("ul",ee,[(a(!0),d(q,null,z(k.nodes,t=>(a(),d("li",{key:t.id,class:"tree-item"},[e("div",{class:O(["tree-content",{selected:k.selectedId===t.id}]),onClick:u=>r(t.id)},[t.children&&t.children.length>0?(a(),d("button",{key:0,class:"icon-btn toggle-btn",onClick:C(u=>s(t.id),["stop"])},[p.value.has(t.id)?(a(),x(f(K),{key:0,size:16})):(a(),x(f(W),{key:1,size:16}))],8,se)):(a(),d("span",ne)),p.value.has(t.id)?(a(),x(f(X),{key:2,size:18,class:"folder-icon"})):(a(),x(f(Y),{key:3,size:18,class:"folder-icon"})),e("span",oe,g(t.name),1),e("div",ae,[e("button",{class:"icon-btn",onClick:C(u=>m("add",t.id),["stop"]),title:"Add Subcategory"},[y(f(D),{size:14})],8,le),e("button",{class:"icon-btn",onClick:C(u=>m("edit",t),["stop"]),title:"Edit"},[y(f(L),{size:14})],8,ie),e("button",{class:"icon-btn danger",onClick:C(u=>m("delete",t.id),["stop"]),title:"Delete"},[y(f(M),{size:14})],8,de)])],10,te),p.value.has(t.id)&&t.children.length>0?(a(),d("div",re,[y(n,{nodes:t.children,selectedId:k.selectedId,onSelect:l[0]||(l[0]=u=>m("select",u)),onAdd:l[1]||(l[1]=u=>m("add",u)),onEdit:l[2]||(l[2]=u=>m("edit",u)),onDelete:l[3]||(l[3]=u=>m("delete",u))},null,8,["nodes","selectedId"])])):A("",!0)]))),128))])}}}),ce=T(ue,[["__scopeId","data-v-c5424542"]]),ve={class:"editor-card"},me={class:"flex gap-4"},fe={class:"flex-1"},pe={class:"flex-1"},ye={class:"flex justify-end gap-2 mt-4"},_e=V({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(k,{emit:c}){const m=k,p=c,s=b({text:"",correctAnswer:"",difficulty:1,tags:[]}),r=b("");Z(()=>m.question,l=>{l?(s.value={...l},r.value=l.tags.join(", ")):(s.value={text:"",correctAnswer:"",difficulty:1,tags:[]},r.value="")},{immediate:!0});function v(){const l=r.value.split(",").map(t=>t.trim()).filter(t=>t),n={id:s.value.id||E(),text:s.value.text||"",correctAnswer:s.value.correctAnswer||"",difficulty:s.value.difficulty||1,tags:l,categoryId:m.categoryId,nextReviewDate:s.value.nextReviewDate||Date.now(),interval:s.value.interval||0,repetitionFactor:s.value.repetitionFactor||2.5};p("save",n)}return(l,n)=>(a(),d("div",ve,[e("h3",null,g(k.question?"Редактировать вопрос":"Новый вопрос"),1),e("form",{onSubmit:C(v,["prevent"]),class:"flex flex-col gap-4"},[e("div",null,[n[5]||(n[5]=e("label",{class:"block mb-2 font-bold"},"Вопрос (Markdown)",-1)),$(e("textarea",{"onUpdate:modelValue":n[0]||(n[0]=t=>s.value.text=t),rows:"4",required:""},null,512),[[I,s.value.text]])]),e("div",null,[n[6]||(n[6]=e("label",{class:"block mb-2 font-bold"},"Правильный ответ (Markdown)",-1)),$(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=t=>s.value.correctAnswer=t),rows:"4",required:""},null,512),[[I,s.value.correctAnswer]])]),e("div",me,[e("div",fe,[n[7]||(n[7]=e("label",{class:"block mb-2 font-bold"},"Сложность (1-5)",-1)),$(e("input",{"onUpdate:modelValue":n[2]||(n[2]=t=>s.value.difficulty=t),type:"number",min:"1",max:"5",required:""},null,512),[[I,s.value.difficulty,void 0,{number:!0}]])]),e("div",pe,[n[8]||(n[8]=e("label",{class:"block mb-2 font-bold"},"Теги (через запятую)",-1)),$(e("input",{"onUpdate:modelValue":n[3]||(n[3]=t=>r.value=t),type:"text",placeholder:"js, vue, basics"},null,512),[[I,r.value]])])]),e("div",ye,[e("button",{type:"button",onClick:n[4]||(n[4]=t=>p("cancel"))},"Отмена"),n[9]||(n[9]=e("button",{type:"submit",class:"primary"},"Сохранить",-1))])],32)]))}}),ke=T(_e,[["__scopeId","data-v-12c33e65"]]),ge={class:"library-layout"},be={class:"categories-sidebar"},he={class:"sidebar-header"},Ce={class:"tree-container"},we={class:"questions-main"},xe={key:0},$e={class:"main-header"},Ie={class:"count"},qe={key:0,class:"mt-4"},ze={key:1,class:"questions-list mt-4"},Ae={class:"q-content"},De={class:"q-text"},Ve={class:"q-meta"},Te={class:"badge"},Qe={class:"q-actions"},Se=["onClick"],Me=["onClick"],Ee={key:0,class:"empty-state"},Le={key:1,class:"empty-state-main"},Fe=V({__name:"LibraryView",setup(k){const c=U(),{categoriesTree:m,questions:p}=G(c),s=b(null),r=b(!1),v=b(null);J(async()=>{c.isLoaded||await c.loadData()});const l=Q(()=>s.value?p.value.filter(o=>o.categoryId===s.value):[]),n=Q(()=>{if(!s.value)return"";const o=c.categories.find(i=>i.id===s.value);return o?o.name:""});function t(o){s.value=o,r.value=!1}async function u(o){const i=prompt("Введите название категории:");i&&await c.addCategory({id:E(),name:i,parentId:o})}async function F(o){const i=prompt("Новое название:",o.name);!i||i===o.name||await c.updateCategory({...o,name:i})}async function N(o){confirm("Удалить категорию и все вложенные вопросы?")&&(await c.removeCategory(o),s.value===o&&(s.value=null))}function R(){v.value=null,r.value=!0}function j(o){v.value=o,r.value=!0}async function B(o){v.value?await c.updateQuestion(o):await c.addQuestion(o),r.value=!1,v.value=null}async function H(o){confirm("Удалить вопрос?")&&await c.removeQuestion(o)}return(o,i)=>(a(),d("div",ge,[e("aside",be,[e("div",he,[i[2]||(i[2]=e("h2",null,"Категории",-1)),e("button",{class:"icon-btn",onClick:i[0]||(i[0]=_=>u(null)),title:"Add Root Category"},[y(f(D),{size:20})])]),e("div",Ce,[y(ce,{nodes:f(m),selectedId:s.value,onSelect:t,onAdd:u,onEdit:F,onDelete:N},null,8,["nodes","selectedId"])])]),e("main",we,[s.value?(a(),d("div",xe,[e("div",$e,[e("h2",null,[S(g(n.value)+" ",1),e("span",Ie,"("+g(l.value.length)+")",1)]),r.value?A("",!0):(a(),d("button",{key:0,class:"primary",onClick:R},[y(f(D),{size:16,style:{"margin-right":"8px"}}),i[3]||(i[3]=S(" Добавить вопрос ",-1))]))]),r.value?(a(),d("div",qe,[y(ke,{question:v.value,categoryId:s.value,onSave:B,onCancel:i[1]||(i[1]=_=>r.value=!1)},null,8,["question","categoryId"])])):(a(),d("div",ze,[(a(!0),d(q,null,z(l.value,_=>(a(),d("div",{key:_.id,class:"question-card"},[e("div",Ae,[e("div",De,g(_.text),1),e("div",Ve,[e("span",Te,"Diff: "+g(_.difficulty),1),(a(!0),d(q,null,z(_.tags,w=>(a(),d("span",{key:w,class:"badge tag"},g(w),1))),128))])]),e("div",Qe,[e("button",{class:"icon-btn",onClick:w=>j(_)},[y(f(L),{size:16})],8,Se),e("button",{class:"icon-btn danger",onClick:w=>H(_.id)},[y(f(M),{size:16})],8,Me)])]))),128)),l.value.length===0?(a(),d("p",Ee," В этой категории пока нет вопросов. ")):A("",!0)]))])):(a(),d("div",Le,[...i[4]||(i[4]=[e("p",null,"Выберите категорию слева, чтобы управлять вопросами.",-1)])]))])]))}}),He=T(Fe,[["__scopeId","data-v-5fd9222a"]]);export{He as default};
