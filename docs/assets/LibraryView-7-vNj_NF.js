import{u as G}from"./data-D8xFFc8O.js";import{c as w,d as S,r as C,a as d,F as T,b as q,e as J,o as r,f as e,g as z,h as $,w as h,u as m,t as _,i as g,n as K,_ as Q,j as W,k as D,v as I,s as X,l as Y,m as M,p as E}from"./index-CzrMAH3a.js";import{T as L}from"./trash-2-Bzp3c7nf.js";import{v as F}from"./v4-EwEgHOG0.js";const ee=w("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const te=w("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const se=w("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const ne=w("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const N=w("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const V=w("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),oe={class:"tree-list"},ae=["onClick","onDragstart","onDrop"],le=["onClick"],ie={key:1,class:"spacer"},re={class:"node-name"},de={class:"actions"},ue=["onClick"],ce=["onClick"],ve=["onClick"],fe={key:0,class:"children"},pe=S({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete","dragstart","drop"],setup(b,{emit:c}){const u=c,y=C(new Set);function s(f){y.value.has(f)?y.value.delete(f):y.value.add(f)}function v(f){u("select",f)}return(f,a)=>{const o=J("CategoryTree",!0);return r(),d("ul",oe,[(r(!0),d(T,null,q(b.nodes,t=>(r(),d("li",{key:t.id,class:"tree-item"},[e("div",{class:K(["tree-content",{selected:b.selectedId===t.id}]),onClick:i=>v(t.id),draggable:"true",onDragstart:i=>u("dragstart",i,t),onDrop:i=>u("drop",i,t),onDragover:a[0]||(a[0]=h(()=>{},["prevent"]))},[t.children&&t.children.length>0?(r(),d("button",{key:0,class:"icon-btn toggle-btn",onClick:h(i=>s(t.id),["stop"])},[y.value.has(t.id)?(r(),$(m(ee),{key:0,size:16})):(r(),$(m(te),{key:1,size:16}))],8,le)):(r(),d("span",ie)),y.value.has(t.id)?(r(),$(m(se),{key:2,size:18,class:"folder-icon"})):(r(),$(m(ne),{key:3,size:18,class:"folder-icon"})),e("span",re,_(t.name),1),e("div",de,[e("button",{class:"icon-btn",onClick:h(i=>u("add",t.id),["stop"]),title:"Add Subcategory"},[g(m(V),{size:14})],8,ue),e("button",{class:"icon-btn",onClick:h(i=>u("edit",t),["stop"]),title:"Edit"},[g(m(N),{size:14})],8,ce),e("button",{class:"icon-btn danger",onClick:h(i=>u("delete",t.id),["stop"]),title:"Delete"},[g(m(L),{size:14})],8,ve)])],42,ae),y.value.has(t.id)&&t.children.length>0?(r(),d("div",fe,[g(o,{nodes:t.children,selectedId:b.selectedId,onSelect:a[1]||(a[1]=i=>u("select",i)),onAdd:a[2]||(a[2]=i=>u("add",i)),onEdit:a[3]||(a[3]=i=>u("edit",i)),onDelete:a[4]||(a[4]=i=>u("delete",i)),onDragstart:a[5]||(a[5]=(i,x)=>u("dragstart",i,x)),onDrop:a[6]||(a[6]=(i,x)=>u("drop",i,x))},null,8,["nodes","selectedId"])])):z("",!0)]))),128))])}}}),me=Q(pe,[["__scopeId","data-v-b71eabcd"]]),ye={class:"editor-card"},ge={class:"flex gap-4"},be={class:"flex-1"},ke={class:"flex-1"},_e={class:"flex justify-end gap-2 mt-4"},Ce=S({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(b,{emit:c}){const u=b,y=c,s=C({text:"",correctAnswer:"",difficulty:1,tags:[]}),v=C("");W(()=>u.question,a=>{a?(s.value={...a},v.value=a.tags.join(", ")):(s.value={text:"",correctAnswer:"",difficulty:1,tags:[]},v.value="")},{immediate:!0});function f(){const a=v.value.split(",").map(t=>t.trim()).filter(t=>t),o={id:s.value.id||F(),text:s.value.text||"",correctAnswer:s.value.correctAnswer||"",difficulty:s.value.difficulty||1,tags:a,categoryId:u.categoryId,nextReviewDate:s.value.nextReviewDate||Date.now(),interval:s.value.interval||0,repetitionFactor:s.value.repetitionFactor||2.5};y("save",o)}return(a,o)=>(r(),d("div",ye,[e("h3",null,_(b.question?"Редактировать вопрос":"Новый вопрос"),1),e("form",{onSubmit:h(f,["prevent"]),class:"flex flex-col gap-4"},[e("div",null,[o[5]||(o[5]=e("label",{class:"block mb-2 font-bold"},"Вопрос (Markdown)",-1)),D(e("textarea",{"onUpdate:modelValue":o[0]||(o[0]=t=>s.value.text=t),rows:"4",required:""},null,512),[[I,s.value.text]])]),e("div",null,[o[6]||(o[6]=e("label",{class:"block mb-2 font-bold"},"Правильный ответ (Markdown)",-1)),D(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=t=>s.value.correctAnswer=t),rows:"4",required:""},null,512),[[I,s.value.correctAnswer]])]),e("div",ge,[e("div",be,[o[7]||(o[7]=e("label",{class:"block mb-2 font-bold"},"Сложность (1-5)",-1)),D(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>s.value.difficulty=t),type:"number",min:"1",max:"5",required:""},null,512),[[I,s.value.difficulty,void 0,{number:!0}]])]),e("div",ke,[o[8]||(o[8]=e("label",{class:"block mb-2 font-bold"},"Теги (через запятую)",-1)),D(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>v.value=t),type:"text",placeholder:"js, vue, basics"},null,512),[[I,v.value]])])]),e("div",_e,[e("button",{type:"button",onClick:o[4]||(o[4]=t=>y("cancel"))},"Отмена"),o[9]||(o[9]=e("button",{type:"submit",class:"primary"},"Сохранить",-1))])],32)]))}}),he=Q(Ce,[["__scopeId","data-v-12c33e65"]]),we={class:"library-layout"},xe={class:"categories-sidebar"},$e={class:"sidebar-header"},De={class:"tree-container"},Ie={class:"questions-main"},Ae={key:0},Te={class:"main-header"},qe={class:"count"},ze={key:0,class:"mt-4"},Ve={key:1,class:"questions-list mt-4"},Se={class:"q-content"},Qe={class:"q-text"},Me={class:"q-meta"},Ee={class:"badge"},Le={class:"q-actions"},Fe=["onClick"],Ne=["onClick"],Re={key:0,class:"empty-state"},je={key:1,class:"empty-state-main"},Be=S({__name:"LibraryView",setup(b){const c=G(),{categoriesTree:u,questions:y}=X(c),s=C(null),v=C(!1),f=C(null);Y(async()=>{c.isLoaded||await c.loadData()});const a=M(()=>s.value?y.value.filter(n=>n.categoryId===s.value):[]),o=M(()=>{if(!s.value)return"";const n=c.categories.find(l=>l.id===s.value);return n?n.name:""});function t(n){s.value=n,v.value=!1}async function i(n){const l=prompt("Введите название категории:");l&&await c.addCategory({id:F(),name:l,parentId:n})}async function x(n){const l=prompt("Новое название:",n.name);!l||l===n.name||await c.updateCategory({...n,name:l})}async function R(n){confirm("Удалить категорию и все вложенные вопросы?")&&(await c.removeCategory(n),s.value===n&&(s.value=null))}function j(){f.value=null,v.value=!0}function B(n){f.value=n,v.value=!0}async function H(n){f.value?await c.updateQuestion(n):await c.addQuestion(n),v.value=!1,f.value=null}async function U(n){confirm("Удалить вопрос?")&&await c.removeQuestion(n)}const A=C(null);function P(n,l){A.value=l,n.dataTransfer&&(n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",l.id))}async function O(n,l){const p=A.value?.id;if(!p||p===l.id)return;const k=c.categories.find(Z=>Z.id===p);k&&await c.updateCategory({...k,parentId:l.id}),A.value=null}return(n,l)=>(r(),d("div",we,[e("aside",xe,[e("div",$e,[l[2]||(l[2]=e("h2",null,"Категории",-1)),e("button",{class:"icon-btn",onClick:l[0]||(l[0]=p=>i(null)),title:"Add Root Category"},[g(m(V),{size:20})])]),e("div",De,[g(me,{nodes:m(u),selectedId:s.value,onSelect:t,onAdd:i,onEdit:x,onDelete:R,onDragstart:P,onDrop:O},null,8,["nodes","selectedId"])])]),e("main",Ie,[s.value?(r(),d("div",Ae,[e("div",Te,[e("h2",null,[E(_(o.value)+" ",1),e("span",qe,"("+_(a.value.length)+")",1)]),v.value?z("",!0):(r(),d("button",{key:0,class:"primary",onClick:j},[g(m(V),{size:16,style:{"margin-right":"8px"}}),l[3]||(l[3]=E(" Добавить вопрос ",-1))]))]),v.value?(r(),d("div",ze,[g(he,{question:f.value,categoryId:s.value,onSave:H,onCancel:l[1]||(l[1]=p=>v.value=!1)},null,8,["question","categoryId"])])):(r(),d("div",Ve,[(r(!0),d(T,null,q(a.value,p=>(r(),d("div",{key:p.id,class:"question-card"},[e("div",Se,[e("div",Qe,_(p.text),1),e("div",Me,[e("span",Ee,"Diff: "+_(p.difficulty),1),(r(!0),d(T,null,q(p.tags,k=>(r(),d("span",{key:k,class:"badge tag"},_(k),1))),128))])]),e("div",Le,[e("button",{class:"icon-btn",onClick:k=>B(p)},[g(m(N),{size:16})],8,Fe),e("button",{class:"icon-btn danger",onClick:k=>U(p.id)},[g(m(L),{size:16})],8,Ne)])]))),128)),a.value.length===0?(r(),d("p",Re," В этой категории пока нет вопросов. ")):z("",!0)]))])):(r(),d("div",je,[...l[4]||(l[4]=[e("p",null,"Выберите категорию слева, чтобы управлять вопросами.",-1)])]))])]))}}),Ze=Q(Be,[["__scopeId","data-v-e020075a"]]);export{Ze as default};
