import{c as k,d as q,l as D,r as v,m as L,y as C,p as m,a as i,f as s,j as p,u as _,C as T,t as n,x as y,D as z,g as I,F as N,b as V,o as r,n as B,_ as M}from"./index-CTHxTBwH.js";import{a as F}from"./ai-CfbRAcN9.js";import{a as $}from"./markdown-DbG5hxBn.js";const j=k("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),H={class:"container"},Q={class:"stats-grid mt-4"},E={class:"card stat-card"},J={class:"stat-icon"},O={class:"stat-info"},R={class:"stat-value"},U={class:"card stat-card"},G={class:"stat-icon"},K={class:"stat-info"},P={class:"stat-value"},W={class:"card mt-4"},X={class:"flex justify-between items-center mb-4"},Y=["disabled"],Z=["innerHTML"],ss={key:1,class:"opacity-70"},ts={class:"card mt-4"},es={class:"history-list mt-4"},as={class:"history-header"},ns={class:"date"},os={class:"history-q"},is={class:"q-text-preview"},rs={class:"user-answer-preview"},ls={key:0,class:"opacity-70"},cs=q({__name:"StatsView",setup(ds){const l=D(),o=v([]),S=v(!0),d=v(""),u=v(!1);L(async()=>{l.isLoaded||await l.loadData();const a=[];for(const t of l.questions){const e=await C.getAttemptsByQuestion(t.id);a.push(...e)}o.value=a.sort((t,e)=>e.date-t.date),S.value=!1});const c=m(()=>o.value.length),f=m(()=>c.value===0?0:(o.value.reduce((t,e)=>t+e.aiScore,0)/c.value).toFixed(1)),h=m(()=>o.value.slice(0,10));async function x(){if(o.value.length===0)return;u.value=!0;const a=o.value.slice(0,20).map(e=>{const g=l.questions.find(b=>b.id===e.questionId);return{question:g?g.text:"Deleted",score:e.aiScore,userAnswer:e.userAnswer,feedback:e.aiFeedback}}),t=`
  Total Attempts: ${c.value}
  Average Score: ${f.value}
  Recent Activity: ${JSON.stringify(a)}
`;try{const e=await F.chat([{role:"system",content:"Ты аналитик обучения. Проанализируй статистику пользователя и дай советы по улучшению знаний. Будь краток и конструктивен."},{role:"user",content:`Вот моя статистика:
${t}`}],async()=>({}));d.value=e.content||"Не удалось получить анализ."}catch(e){console.error(e),d.value="Ошибка анализа."}finally{u.value=!1}}function A(a){return new Date(a).toLocaleDateString()+" "+new Date(a).toLocaleTimeString()}function w(a){const t=l.questions.find(e=>e.id===a);return t?t.text.substring(0,100)+(t.text.length>100?"...":""):"Вопрос удален"}return(a,t)=>(r(),i("div",H,[t[6]||(t[6]=s("h1",null,"Статистика",-1)),s("div",Q,[s("div",E,[s("div",J,[p(_(T),{size:32})]),s("div",O,[s("span",R,n(c.value),1),t[0]||(t[0]=s("span",{class:"stat-label"},"Всего ответов",-1))])]),s("div",U,[s("div",G,[p(_(j),{size:32})]),s("div",K,[s("span",P,n(f.value),1),t[1]||(t[1]=s("span",{class:"stat-label"},"Средний балл",-1))])])]),s("div",W,[s("div",X,[t[2]||(t[2]=s("h3",null,"AI Анализ",-1)),s("button",{class:"primary",onClick:x,disabled:u.value||c.value===0},[p(_(z),{size:16,style:{"margin-right":"8px"}}),y(" "+n(u.value?"Анализ...":"Анализировать"),1)],8,Y)]),d.value?(r(),i("div",{key:0,class:"markdown-body",innerHTML:_($)(d.value)},null,8,Z)):(r(),i("p",ss,"Нажмите кнопку, чтобы получить советы от AI на основе вашей статистики."))]),s("div",ts,[t[5]||(t[5]=s("h3",null,"История активности",-1)),s("div",es,[(r(!0),i(N,null,V(h.value,e=>(r(),i("div",{key:e.id,class:"history-item"},[s("div",as,[s("span",ns,n(A(e.date)),1),s("span",{class:B(["score",e.aiScore>=7?"text-success":"text-danger"])},n(e.aiScore)+"/10 ",3)]),s("div",os,[s("div",is,[t[3]||(t[3]=s("strong",null,"Вопрос:",-1)),y(" "+n(w(e.questionId)),1)]),s("div",rs,[t[4]||(t[4]=s("strong",null,"Ваш ответ:",-1)),y(" "+n(e.userAnswer),1)])])]))),128)),h.value.length===0?(r(),i("p",ls,"История пуста.")):I("",!0)])])]))}}),ms=M(cs,[["__scopeId","data-v-5496d493"]]);export{ms as default};
