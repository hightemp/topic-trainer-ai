import{c as $,d as F,r as y,w as H,a as f,F as A,b as V,e as ve,o as r,f as a,g as E,h as M,i as D,u as g,t as x,j as b,n as W,_ as U,k as I,v as S,l as fe,s as pe,m as me,p as Q,q as ye,x as O}from"./index-CTHxTBwH.js";import{T as J}from"./trash-2-DDzpCoAd.js";import{v as P}from"./v4-EwEgHOG0.js";import{r as ge}from"./markdown-DbG5hxBn.js";const be=$("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const he=$("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ke=$("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const Ce=$("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const X=$("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const R=$("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),we={class:"tree-list"},_e=["onClick","onDragstart","onDrop"],De=["onClick"],xe={key:1,class:"spacer"},Ie={class:"node-name"},Se={class:"actions"},$e=["onClick"],Te=["onClick"],ze=["onClick"],qe={key:0,class:"children"},Me=F({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete","dragstart","drop"],setup(C,{emit:u}){const _=C,p=u,o=y(new Set),c=n=>{n.forEach(s=>{o.value.add(s.id),s.children&&s.children.length>0&&c(s.children)})};H(()=>_.nodes,n=>{o.value.size===0&&n.length>0&&c(n)},{immediate:!0});function h(n){o.value.has(n)?o.value.delete(n):o.value.add(n)}function m(n){p("select",n)}return(n,s)=>{const k=ve("CategoryTree",!0);return r(),f("ul",we,[(r(!0),f(A,null,V(C.nodes,d=>(r(),f("li",{key:d.id,class:"tree-item"},[a("div",{class:W(["tree-content",{selected:C.selectedId===d.id}]),onClick:i=>m(d.id),draggable:"true",onDragstart:i=>p("dragstart",i,d),onDrop:i=>p("drop",i,d),onDragover:s[0]||(s[0]=D(()=>{},["prevent"]))},[d.children&&d.children.length>0?(r(),f("button",{key:0,class:"icon-btn toggle-btn",onClick:D(i=>h(d.id),["stop"])},[o.value.has(d.id)?(r(),M(g(be),{key:0,size:16})):(r(),M(g(he),{key:1,size:16}))],8,De)):(r(),f("span",xe)),o.value.has(d.id)?(r(),M(g(ke),{key:2,size:18,class:"folder-icon"})):(r(),M(g(Ce),{key:3,size:18,class:"folder-icon"})),a("span",Ie,x(d.name),1),a("div",Se,[a("button",{class:"icon-btn",onClick:D(i=>p("add",d.id),["stop"]),title:"Add Subcategory"},[b(g(R),{size:14})],8,$e),a("button",{class:"icon-btn",onClick:D(i=>p("edit",d),["stop"]),title:"Edit"},[b(g(X),{size:14})],8,Te),a("button",{class:"icon-btn danger",onClick:D(i=>p("delete",d.id),["stop"]),title:"Delete"},[b(g(J),{size:14})],8,ze)])],42,_e),o.value.has(d.id)&&d.children.length>0?(r(),f("div",qe,[b(k,{nodes:d.children,selectedId:C.selectedId,onSelect:s[1]||(s[1]=i=>p("select",i)),onAdd:s[2]||(s[2]=i=>p("add",i)),onEdit:s[3]||(s[3]=i=>p("edit",i)),onDelete:s[4]||(s[4]=i=>p("delete",i)),onDragstart:s[5]||(s[5]=(i,T)=>p("dragstart",i,T)),onDrop:s[6]||(s[6]=(i,T)=>p("drop",i,T))},null,8,["nodes","selectedId"])])):E("",!0)]))),128))])}}}),Le=U(Me,[["__scopeId","data-v-abd248e4"]]),Qe={class:"editor-card"},Ae={class:"flex gap-4"},Ve={class:"flex-1"},Ee={class:"flex-1"},Re={class:"flex justify-end gap-2 mt-4"},Fe=F({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(C,{emit:u}){const _=C,p=u,o=y({text:"",correctAnswer:"",difficulty:1,tags:[]}),c=y("");H(()=>_.question,m=>{m?(o.value={...m},c.value=m.tags.join(", ")):(o.value={text:"",correctAnswer:"",difficulty:1,tags:[]},c.value="")},{immediate:!0});function h(){const m=c.value.split(",").map(s=>s.trim()).filter(s=>s),n={id:o.value.id||P(),text:o.value.text||"",correctAnswer:o.value.correctAnswer||"",difficulty:o.value.difficulty||1,tags:m,categoryId:_.categoryId,nextReviewDate:o.value.nextReviewDate||Date.now(),interval:o.value.interval||0,repetitionFactor:o.value.repetitionFactor||2.5};p("save",n)}return(m,n)=>(r(),f("div",Qe,[a("h3",null,x(C.question?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å":"–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å"),1),a("form",{onSubmit:D(h,["prevent"]),class:"flex flex-col gap-4"},[a("div",null,[n[5]||(n[5]=a("label",{class:"block mb-2 font-bold"},"–í–æ–ø—Ä–æ—Å (Markdown)",-1)),I(a("textarea",{"onUpdate:modelValue":n[0]||(n[0]=s=>o.value.text=s),rows:"4",required:""},null,512),[[S,o.value.text]])]),a("div",null,[n[6]||(n[6]=a("label",{class:"block mb-2 font-bold"},"–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (Markdown)",-1)),I(a("textarea",{"onUpdate:modelValue":n[1]||(n[1]=s=>o.value.correctAnswer=s),rows:"4",required:""},null,512),[[S,o.value.correctAnswer]])]),a("div",Ae,[a("div",Ve,[n[7]||(n[7]=a("label",{class:"block mb-2 font-bold"},"–°–ª–æ–∂–Ω–æ—Å—Ç—å (1-5)",-1)),I(a("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>o.value.difficulty=s),type:"number",min:"1",max:"5",required:""},null,512),[[S,o.value.difficulty,void 0,{number:!0}]])]),a("div",Ee,[n[8]||(n[8]=a("label",{class:"block mb-2 font-bold"},"–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)",-1)),I(a("input",{"onUpdate:modelValue":n[3]||(n[3]=s=>c.value=s),type:"text",placeholder:"js, vue, basics"},null,512),[[S,c.value]])])]),a("div",Re,[a("button",{type:"button",onClick:n[4]||(n[4]=s=>p("cancel"))},"–û—Ç–º–µ–Ω–∞"),n[9]||(n[9]=a("button",{type:"submit",class:"primary"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",-1))])],32)]))}}),He=U(Fe,[["__scopeId","data-v-12c33e65"]]),Ue={class:"sidebar-header"},Ne={class:"search-box mb-2"},je={class:"tree-container"},Be={class:"questions-main"},Oe={key:0},We={class:"main-header"},Je={class:"count"},Pe={class:"header-actions"},Xe={key:0,class:"mt-4"},Ze={key:1,class:"questions-list mt-4"},Ge=["onDragstart"],Ke=["innerHTML"],Ye={class:"q-meta"},et={class:"q-actions"},tt=["onClick"],at=["onClick"],st={key:0,class:"empty-state"},nt={key:1,class:"empty-state-main"},ot={name:"LibraryView"},lt=F({...ot,setup(C){const u=fe(),{categoriesTree:_,questions:p}=pe(u),o=y(null),c=y(!1),h=y(null),m=y(300),n=y(!1),s=y(""),k=y("");me(async()=>{u.isLoaded||await u.loadData();const e=localStorage.getItem("library-sidebar-width");e&&(m.value=parseInt(e,10));const t=localStorage.getItem("library-state");if(t)try{const l=JSON.parse(t);o.value=l.selectedCategoryId||null,c.value=l.showQuestionEditor||!1,s.value=l.categorySearch||"",k.value=l.questionSearch||""}catch(l){console.error("Failed to load library state:",l)}}),H([o,c,s,k],()=>{const e={selectedCategoryId:o.value,showQuestionEditor:c.value,categorySearch:s.value,questionSearch:k.value};localStorage.setItem("library-state",JSON.stringify(e))});const d=Q(()=>{if(!o.value)return[];let e=p.value.filter(t=>t.categoryId===o.value);if(k.value.trim()){const t=k.value.toLowerCase();e=e.filter(l=>l.text.toLowerCase().includes(t)||l.tags.some(v=>v.toLowerCase().includes(t)))}return e}),i=Q(()=>{if(!s.value.trim())return _.value;const e=s.value.toLowerCase(),t=l=>l.reduce((v,w)=>{const L=w.name.toLowerCase().includes(e),B=t(w.children||[]);return(L||B.length>0)&&v.push({...w,children:B}),v},[]);return t(_.value)}),T=Q(()=>{if(!o.value)return"";const e=u.categories.find(t=>t.id===o.value);return e?e.name:""});function Z(e){o.value=e,c.value=!1}async function N(e){const t=prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:");t&&await u.addCategory({id:P(),name:t,parentId:e})}async function G(e){const t=prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:",e.name);!t||t===e.name||await u.updateCategory({...e,name:t})}async function K(e){confirm("–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã?")&&(await u.removeCategory(e),o.value===e&&(o.value=null))}function Y(){h.value=null,c.value=!0}function ee(e){h.value=e,c.value=!0}async function te(e){h.value?await u.updateQuestion(e):await u.addQuestion(e),c.value=!1,h.value=null}async function ae(e){confirm("–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å?")&&await u.removeQuestion(e)}const z=y(null);function se(e,t){z.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id))}const q=y(null);function ne(e,t){q.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.setData("type","question"))}async function oe(e,t){if(e.dataTransfer?.getData("type")==="question"&&q.value){q.value.categoryId!==t.id&&await u.updateQuestion({...q.value,categoryId:t.id}),q.value=null;return}const v=z.value?.id;if(!v||v===t.id)return;const w=u.categories.find(L=>L.id===v);w&&await u.updateCategory({...w,parentId:t.id}),z.value=null}function le(e){return["–õ–µ–≥–∫–∏–π","–ü—Ä–æ—Å—Ç–æ–π","–°—Ä–µ–¥–Ω–∏–π","–°–ª–æ–∂–Ω—ã–π","–≠–∫—Å–ø–µ—Ä—Ç"][e-1]||e}function ie(e){return e<=2?"diff-easy":e===3?"diff-medium":"diff-hard"}function re(e){n.value=!0,e.preventDefault()}function j(){n.value&&(n.value=!1,localStorage.setItem("library-sidebar-width",m.value.toString()))}function de(e){if(!n.value)return;const l=e.clientX-280;l>=200&&l<=600&&(m.value=l)}async function ue(e){if(e.preventDefault(),e.dataTransfer?.getData("type")==="question")return;const l=z.value?.id;if(!l)return;const v=u.categories.find(w=>w.id===l);v&&await u.updateCategory({...v,parentId:null}),z.value=null}function ce(e){e.preventDefault(),e.dataTransfer?.getData("type")!=="question"&&(e.dataTransfer.dropEffect="move")}return(e,t)=>(r(),f("div",{class:"library-layout",onMousemove:de,onMouseup:j,onMouseleave:j},[a("aside",{class:"categories-sidebar",style:ye({width:m.value+"px"})},[a("div",Ue,[t[4]||(t[4]=a("h2",null,"–ö–∞—Ç–µ–≥–æ—Ä–∏–∏",-1)),a("button",{class:"icon-btn",onClick:t[0]||(t[0]=l=>N(null)),title:"–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é"},[b(g(R),{size:20})])]),a("div",Ne,[I(a("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value=l),type:"text",placeholder:"–ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",class:"search-input"},null,512),[[S,s.value]])]),a("div",{class:"drop-to-root-zone",onDrop:ue,onDragover:ce},[...t[5]||(t[5]=[a("span",{class:"drop-hint"},"üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ –∫–æ—Ä–µ–Ω—å",-1)])],32),a("div",je,[b(Le,{nodes:i.value,selectedId:o.value,onSelect:Z,onAdd:N,onEdit:G,onDelete:K,onDragstart:se,onDrop:oe},null,8,["nodes","selectedId"])])],4),a("div",{class:"resizer",onMousedown:re},null,32),a("main",Be,[o.value?(r(),f("div",Oe,[a("div",We,[a("h2",null,[O(x(T.value)+" ",1),a("span",Je,"("+x(d.value.length)+")",1)]),a("div",Pe,[I(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>k.value=l),type:"text",placeholder:"–ü–æ–∏—Å–∫ –≤–æ–ø—Ä–æ—Å–æ–≤...",class:"search-input question-search"},null,512),[[S,k.value]]),c.value?E("",!0):(r(),f("button",{key:0,class:"primary",onClick:Y},[b(g(R),{size:16,style:{"margin-right":"8px"}}),t[6]||(t[6]=O(" –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å ",-1))]))])]),c.value?(r(),f("div",Xe,[b(He,{question:h.value,categoryId:o.value,onSave:te,onCancel:t[3]||(t[3]=l=>c.value=!1)},null,8,["question","categoryId"])])):(r(),f("div",Ze,[(r(!0),f(A,null,V(d.value,l=>(r(),f("div",{key:l.id,class:"question-card"},[a("div",{class:"q-content",draggable:"true",onDragstart:v=>ne(v,l)},[a("div",{class:"q-text markdown-content",innerHTML:g(ge)(l.text)},null,8,Ke),a("div",Ye,[a("span",{class:W(["badge",ie(l.difficulty)])},x(le(l.difficulty)),3),(r(!0),f(A,null,V(l.tags,v=>(r(),f("span",{key:v,class:"badge tag"},x(v),1))),128))])],40,Ge),a("div",et,[a("button",{class:"icon-btn",onClick:v=>ee(l)},[b(g(X),{size:16})],8,tt),a("button",{class:"icon-btn danger",onClick:v=>ae(l.id)},[b(g(J),{size:16})],8,at)])]))),128)),d.value.length===0?(r(),f("p",st," –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤. ")):E("",!0)]))])):(r(),f("div",nt,[...t[7]||(t[7]=[a("p",null,"–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–æ–ø—Ä–æ—Å–∞–º–∏.",-1)])]))])],32))}}),ct=U(lt,[["__scopeId","data-v-7c0fa7bc"]]);export{ct as default};
