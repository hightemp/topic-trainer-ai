import{c as h,d as B,l as Q,r as y,m as S,z as q,a as c,f as s,g as k,F as b,b as g,j as p,u as d,t as C,i as x,k as L,v as D,A as H,B as U,o as n,n as F,h as I,_ as K}from"./index-Zg22DbRy.js";import{a as N}from"./ai-DLb66c8R.js";import{a as j}from"./markdown-vDNTwY9N.js";import{T as E}from"./trash-2-CBM2pIUd.js";import{v as M}from"./v4-EwEgHOG0.js";const z=h("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const $=h("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const G=h("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const P=h("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const R=h("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),J={class:"chat-layout"},O={class:"avatar"},W={class:"bubble"},X=["innerHTML"],Y={key:1,class:"tool-calls"},Z={key:0,class:"message assistant"},ee={class:"avatar"},te={class:"bubble loading"},ae={class:"input-area"},se={class:"toolbar"},oe={class:"toolbar-info"},ne={class:"message-count"},re=["disabled","onKeydown"],ie=["disabled"],le=B({__name:"ChatView",setup(ce){const i=Q(),l=y([]),v=y(""),f=y(!1),_=y(null),u=y(null);S(()=>{l.value.push({role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."})});async function m(){await U(),_.value&&(_.value.scrollTop=_.value.scrollHeight)}async function A(o,t){if(console.log("Tool Call:",o,t),o==="create_category"){const e=M();return await i.addCategory({id:e,name:t.name,parentId:t.parentId||null}),{success:!0,id:e,message:`Category "${t.name}" created.`}}if(o==="create_question"){const e=M();return await i.addQuestion({id:e,text:t.text,correctAnswer:t.correctAnswer,difficulty:t.difficulty,tags:t.tags||[],categoryId:t.categoryId,nextReviewDate:Date.now(),interval:0,repetitionFactor:2.5}),{success:!0,id:e,message:"Question created."}}if(o==="get_categories")return i.categories.map(e=>({id:e.id,name:e.name,parentId:e.parentId}));if(o==="update_category"){const e=i.categories.find(a=>a.id===t.id);return e?(await i.updateCategory({...e,name:t.name||e.name,parentId:t.parentId!==void 0?t.parentId:e.parentId}),{success:!0,message:"Category updated."}):{error:"Category not found"}}if(o==="delete_category")return await i.removeCategory(t.id),{success:!0,message:"Category deleted."};if(o==="get_questions"){let e=i.questions;t.categoryId&&(e=e.filter(r=>r.categoryId===t.categoryId));const a=t.limit||20;return e.slice(0,a).map(r=>({id:r.id,text:r.text,correctAnswer:r.correctAnswer,difficulty:r.difficulty,tags:r.tags,categoryId:r.categoryId}))}if(o==="update_question"){const e=i.questions.find(a=>a.id===t.id);return e?(await i.updateQuestion({...e,text:t.text||e.text,correctAnswer:t.correctAnswer||e.correctAnswer,difficulty:t.difficulty||e.difficulty,tags:t.tags||e.tags,categoryId:t.categoryId||e.categoryId}),{success:!0,message:"Question updated."}):{error:"Question not found"}}return o==="delete_question"?(await i.removeQuestion(t.id),{success:!0,message:"Question deleted."}):{error:"Unknown tool"}}function T(){u.value&&(u.value.abort(),u.value=null,f.value=!1,l.value.push({role:"assistant",content:"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."}),m())}function V(){confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?")&&(l.value=[{role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."}])}async function w(){if(!v.value.trim()||f.value)return;const o={role:"user",content:v.value};l.value.push(o),v.value="",f.value=!0,m(),u.value=new AbortController;try{const t=l.value.map(a=>({role:a.role,content:a.content,tool_calls:a.tool_calls,tool_call_id:a.tool_call_id,name:a.name})),e=await N.chat(t,A,u.value.signal);e.content?l.value.push({role:"assistant",content:e.content}):e.tool_calls&&l.value.push({role:"assistant",content:e.content||"–ì–æ—Ç–æ–≤–æ."})}catch(t){t.name==="AbortError"||l.value.push({role:"assistant",content:`–û—à–∏–±–∫–∞: ${t.message}`})}finally{u.value&&(f.value=!1,u.value=null),m()}}return q(()=>{u.value&&u.value.abort()}),(o,t)=>(n(),c("div",J,[s("div",{class:"chat-container",ref_key:"chatContainer",ref:_},[(n(!0),c(b,null,g(l.value,(e,a)=>(n(),c("div",{key:a,class:F(["message",e.role])},[s("div",O,[e.role==="assistant"?(n(),I(d(z),{key:0,size:24})):(n(),I(d(R),{key:1,size:24}))]),s("div",W,[e.content?(n(),c("div",{key:0,innerHTML:d(j)(e.content),class:"markdown-content"},null,8,X)):k("",!0),e.tool_calls?(n(),c("div",Y,[(n(!0),c(b,null,g(e.tool_calls,r=>(n(),c("div",{key:r.id,class:"tool-badge"}," üõ†Ô∏è "+C(r.function.name),1))),128))])):k("",!0)])],2))),128)),f.value?(n(),c("div",Z,[s("div",ee,[p(d(z),{size:24})]),s("div",te,[p(d($),{size:20,class:"spin"})])])):k("",!0)],512),s("div",ae,[s("div",se,[s("div",oe,[s("span",ne,C(l.value.length)+" —Å–æ–æ–±—â–µ–Ω–∏–π",1)]),s("button",{type:"button",onClick:V,class:"clear-btn",title:"–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"},[p(d(E),{size:18}),t[1]||(t[1]=s("span",null,"–û—á–∏—Å—Ç–∏—Ç—å",-1))])]),s("form",{onSubmit:x(w,["prevent"]),class:"input-form"},[L(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ Vue 3 Composition API...",disabled:f.value,onKeydown:H(x(w,["exact","prevent"]),["enter"]),rows:"1",class:"chat-input"},null,40,re),[[D,v.value]]),f.value?(n(),c("button",{key:0,type:"button",onClick:T,class:"stop-btn",title:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"},[p(d(P),{size:20,fill:"currentColor"})])):(n(),c("button",{key:1,type:"submit",disabled:!v.value.trim()},[p(d(G),{size:20})],8,ie))],32)])]))}}),pe=K(le,[["__scopeId","data-v-2678cf30"]]);export{pe as default};
