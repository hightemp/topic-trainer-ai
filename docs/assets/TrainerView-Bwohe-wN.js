import{c as b,d as N,r as c,l as $,m as E,a as l,f as s,F as C,b as S,u as y,i as A,p as z,g,q as P,t as u,k as U,v as j,n as w,h as F,x as G,o as n,_ as J}from"./index-Bwu_TVw9.js";import{u as K}from"./data-GoCjVp_s.js";import{a as O,d as W}from"./marked.esm-D-8vLW93.js";import{v as X}from"./v4-EwEgHOG0.js";const Y=b("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Z=b("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const ee=b("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const te=b("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),se={class:"container"},ae={key:0,class:"setup-screen"},ne={class:"card mt-4"},le={class:"tags-cloud"},oe=["onClick"],ie={class:"card mt-4"},re={class:"tags-cloud"},ce=["onClick"],ue={class:"actions mt-4"},de={key:1,class:"training-screen"},ve={class:"progress-bar"},me={class:"question-header"},pe={key:0,class:"timer"},ke={key:0,class:"card question-card"},fe=["innerHTML"],_e={class:"answer-section mt-4"},ye=["disabled"],he={class:"feedback-header"},ge={class:"score"},we={key:0,class:"correct-answer mt-4"},be=["innerHTML"],xe={class:"actions mt-4"},Ce=["disabled"],Se={key:2,class:"result-screen"},Te={class:"card mt-4"},De={class:"result-header"},Me={class:"text-sm"},Ae=N({__name:"TrainerView",setup(ze){const v=K(),f=c("setup"),m=c(new Set),p=c(new Set),L=c(!0),i=c([]),r=c(0),k=c(""),_=c(!1),T=c(0),d=c(null),x=c([]);$(async()=>{v.isLoaded||await v.loadData()});const V=E(()=>{const a=new Set;return v.questions.forEach(t=>t.tags.forEach(e=>a.add(e))),Array.from(a)});function I(a){m.value.has(a)?m.value.delete(a):m.value.add(a)}function B(a){p.value.has(a)?p.value.delete(a):p.value.add(a)}function Q(){let a=v.questions.filter(t=>!(m.value.size>0&&!m.value.has(t.categoryId)||p.value.size>0&&!t.tags.some(e=>p.value.has(e))));if(a.sort((t,e)=>t.nextReviewDate-e.nextReviewDate),i.value=a.slice(0,20),i.value.length===0){alert("Нет вопросов, соответствующих критериям.");return}r.value=0,x.value=[],f.value="training",D()}function D(){k.value="",d.value=null,T.value=Date.now()}async function R(){if(!k.value.trim())return;_.value=!0;const a=i.value[r.value];if(!a)return;const t=(Date.now()-T.value)/1e3;try{const e=await O.evaluateAnswer(a.text,a.correctAnswer,k.value);d.value=e;const o=Math.round(e.score/2);q(a,o);const h={id:X(),questionId:a.id,date:Date.now(),userAnswer:k.value,aiScore:e.score,aiFeedback:e.feedback,duration:t};await G.saveAttempt(h),x.value.push(h)}catch(e){console.error(e),alert("Ошибка проверки ответа")}finally{_.value=!1}}function q(a,t){let e=a.repetitionFactor,o=a.interval;t<3?o=1:(o===0?o=1:o===1?o=6:o=Math.round(o*e),e=e+(.1-(5-t)*(.08+(5-t)*.02)),e<1.3&&(e=1.3));const h=Date.now()+o*24*60*60*1e3;v.updateQuestion({...a,interval:o,repetitionFactor:e,nextReviewDate:h})}function H(){r.value<i.value.length-1?(r.value++,D()):f.value="result"}function M(a){return W(a||"")}return(a,t)=>(n(),l("div",se,[f.value==="setup"?(n(),l("div",ae,[t[5]||(t[5]=s("h1",null,"Настройка тренировки",-1)),s("div",ne,[t[2]||(t[2]=s("h3",null,"Категории",-1)),s("div",le,[(n(!0),l(C,null,S(y(v).categories,e=>(n(),l("button",{key:e.id,class:w(["chip",{active:m.value.has(e.id)}]),onClick:o=>I(e.id)},u(e.name),11,oe))),128))])]),s("div",ie,[t[3]||(t[3]=s("h3",null,"Теги",-1)),s("div",re,[(n(!0),l(C,null,S(V.value,e=>(n(),l("button",{key:e,class:w(["chip",{active:p.value.has(e)}]),onClick:o=>B(e)},u(e),11,ce))),128))])]),s("div",ue,[s("button",{class:"primary large",onClick:Q},[A(y(te),{size:24}),t[4]||(t[4]=z(" Начать ",-1))])])])):f.value==="training"?(n(),l("div",de,[s("div",ve,[s("div",{class:"progress-fill",style:P({width:`${(r.value+1)/i.value.length*100}%`})},null,4)]),s("div",me,[s("span",null,"Вопрос "+u(r.value+1)+" из "+u(i.value.length),1),L.value?(n(),l("span",pe,[A(y(ee),{size:16}),t[6]||(t[6]=z(" ...",-1))])):g("",!0)]),i.value[r.value]?(n(),l("div",ke,[s("div",{class:"markdown-body",innerHTML:M(i.value[r.value]?.text||"")},null,8,fe)])):g("",!0),s("div",_e,[U(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),rows:"6",placeholder:"Ваш ответ...",disabled:!!d.value||_.value},null,8,ye),[[j,k.value]])]),d.value?(n(),l("div",{key:1,class:w(["feedback-section mt-4",d.value.score>=7?"good":"bad"])},[s("div",he,[d.value.score>=7?(n(),F(y(Z),{key:0,size:24})):(n(),F(y(Y),{key:1,size:24})),s("span",ge,"Оценка: "+u(d.value.score)+"/10",1)]),s("p",null,u(d.value.feedback),1),i.value[r.value]?(n(),l("div",we,[t[7]||(t[7]=s("strong",null,"Правильный ответ:",-1)),s("div",{innerHTML:M(i.value[r.value]?.correctAnswer||"")},null,8,be)])):g("",!0)],2)):g("",!0),s("div",xe,[d.value?(n(),l("button",{key:1,class:"primary",onClick:H},u(r.value<i.value.length-1?"Следующий вопрос":"Завершить"),1)):(n(),l("button",{key:0,class:"primary",onClick:R,disabled:_.value},u(_.value?"Проверка...":"Ответить"),9,Ce))])])):(n(),l("div",Se,[t[8]||(t[8]=s("h1",null,"Результаты тренировки",-1)),s("div",Te,[(n(!0),l(C,null,S(x.value,(e,o)=>(n(),l("div",{key:e.id,class:"result-item"},[s("div",De,[s("strong",null,"Вопрос "+u(o+1),1),s("span",{class:w(e.aiScore>=7?"text-success":"text-danger")},u(e.aiScore)+"/10",3)]),s("p",Me,u(e.aiFeedback),1)]))),128))]),s("button",{class:"primary mt-4",onClick:t[1]||(t[1]=e=>f.value="setup")},"Новая тренировка")]))]))}}),Be=J(Ae,[["__scopeId","data-v-6b8ce59d"]]);export{Be as default};
