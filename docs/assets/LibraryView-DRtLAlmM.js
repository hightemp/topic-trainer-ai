import{c as T,d as F,r as y,w as N,a as v,F as V,b as Q,e as ve,o as r,f as s,g as E,h as M,i as _,u as g,t as x,j as b,n as O,_ as H,k as I,v as $,l as fe,s as pe,m as me,p as A,q as ye,x as W}from"./index-Zg22DbRy.js";import{T as P}from"./trash-2-CBM2pIUd.js";import{v as X}from"./v4-EwEgHOG0.js";import{r as ge}from"./markdown-vDNTwY9N.js";const be=T("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const he=T("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ke=T("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const Ce=T("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const Z=T("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const R=T("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),we={class:"tree-list"},De=["onClick","onDragstart","onDrop"],_e=["onClick"],xe={key:1,class:"spacer"},Ie={class:"node-name"},$e={class:"actions"},Te=["onClick"],ze=["onClick"],Se=["onClick"],qe={key:0,class:"children"},Me=F({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete","dragstart","drop"],setup(k,{emit:u}){const w=k,f=u,o=y(new Set),p=a=>{a.forEach(n=>{o.value.add(n.id),n.children&&n.children.length>0&&p(n.children)})};N(()=>w.nodes,a=>{o.value.size===0&&a.length>0&&p(a)},{immediate:!0});function h(a){o.value.has(a)?o.value.delete(a):o.value.add(a)}function m(a){f("select",a)}return(a,n)=>{const D=ve("CategoryTree",!0);return r(),v("ul",we,[(r(!0),v(V,null,Q(k.nodes,d=>(r(),v("li",{key:d.id,class:"tree-item"},[s("div",{class:O(["tree-content",{selected:k.selectedId===d.id}]),onClick:i=>m(d.id),draggable:"true",onDragstart:i=>f("dragstart",i,d),onDrop:i=>f("drop",i,d),onDragover:n[0]||(n[0]=_(()=>{},["prevent"]))},[d.children&&d.children.length>0?(r(),v("button",{key:0,class:"icon-btn toggle-btn",onClick:_(i=>h(d.id),["stop"])},[o.value.has(d.id)?(r(),M(g(be),{key:0,size:16})):(r(),M(g(he),{key:1,size:16}))],8,_e)):(r(),v("span",xe)),o.value.has(d.id)?(r(),M(g(ke),{key:2,size:18,class:"folder-icon"})):(r(),M(g(Ce),{key:3,size:18,class:"folder-icon"})),s("span",Ie,x(d.name),1),s("div",$e,[s("button",{class:"icon-btn",onClick:_(i=>f("add",d.id),["stop"]),title:"Add Subcategory"},[b(g(R),{size:14})],8,Te),s("button",{class:"icon-btn",onClick:_(i=>f("edit",d),["stop"]),title:"Edit"},[b(g(Z),{size:14})],8,ze),s("button",{class:"icon-btn danger",onClick:_(i=>f("delete",d.id),["stop"]),title:"Delete"},[b(g(P),{size:14})],8,Se)])],42,De),o.value.has(d.id)&&d.children.length>0?(r(),v("div",qe,[b(D,{nodes:d.children,selectedId:k.selectedId,onSelect:n[1]||(n[1]=i=>f("select",i)),onAdd:n[2]||(n[2]=i=>f("add",i)),onEdit:n[3]||(n[3]=i=>f("edit",i)),onDelete:n[4]||(n[4]=i=>f("delete",i)),onDragstart:n[5]||(n[5]=(i,z)=>f("dragstart",i,z)),onDrop:n[6]||(n[6]=(i,z)=>f("drop",i,z))},null,8,["nodes","selectedId"])])):E("",!0)]))),128))])}}}),Le=H(Me,[["__scopeId","data-v-abd248e4"]]),Ae={class:"editor-card"},Ve={class:"flex gap-4"},Qe={class:"flex-1"},Ee={class:"flex-1"},Re={class:"flex justify-end gap-2 mt-4"},Fe=F({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(k,{emit:u}){const w=k,f=u,o=y({text:"",correctAnswer:"",difficulty:1,tags:[]}),p=y("");N(()=>w.question,m=>{m?(o.value={...m},p.value=m.tags.join(", ")):(o.value={text:"",correctAnswer:"",difficulty:1,tags:[]},p.value="")},{immediate:!0});function h(){const m=p.value.split(",").map(n=>n.trim()).filter(n=>n),a={id:o.value.id||X(),text:o.value.text||"",correctAnswer:o.value.correctAnswer||"",difficulty:o.value.difficulty||1,tags:m,categoryId:w.categoryId,nextReviewDate:o.value.nextReviewDate||Date.now(),interval:o.value.interval||0,repetitionFactor:o.value.repetitionFactor||2.5};f("save",a)}return(m,a)=>(r(),v("div",Ae,[s("h3",null,x(k.question?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å":"–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å"),1),s("form",{onSubmit:_(h,["prevent"]),class:"flex flex-col gap-4"},[s("div",null,[a[5]||(a[5]=s("label",{class:"block mb-2 font-bold"},"–í–æ–ø—Ä–æ—Å (Markdown)",-1)),I(s("textarea",{"onUpdate:modelValue":a[0]||(a[0]=n=>o.value.text=n),rows:"4",required:""},null,512),[[$,o.value.text]])]),s("div",null,[a[6]||(a[6]=s("label",{class:"block mb-2 font-bold"},"–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (Markdown)",-1)),I(s("textarea",{"onUpdate:modelValue":a[1]||(a[1]=n=>o.value.correctAnswer=n),rows:"4",required:""},null,512),[[$,o.value.correctAnswer]])]),s("div",Ve,[s("div",Qe,[a[7]||(a[7]=s("label",{class:"block mb-2 font-bold"},"–°–ª–æ–∂–Ω–æ—Å—Ç—å (1-5)",-1)),I(s("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>o.value.difficulty=n),type:"number",min:"1",max:"5",required:""},null,512),[[$,o.value.difficulty,void 0,{number:!0}]])]),s("div",Ee,[a[8]||(a[8]=s("label",{class:"block mb-2 font-bold"},"–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)",-1)),I(s("input",{"onUpdate:modelValue":a[3]||(a[3]=n=>p.value=n),type:"text",placeholder:"js, vue, basics"},null,512),[[$,p.value]])])]),s("div",Re,[s("button",{type:"button",onClick:a[4]||(a[4]=n=>f("cancel"))},"–û—Ç–º–µ–Ω–∞"),a[9]||(a[9]=s("button",{type:"submit",class:"primary"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",-1))])],32)]))}}),He=H(Fe,[["__scopeId","data-v-12c33e65"]]),Ue={class:"sidebar-header"},je={class:"search-box mb-2"},Be={class:"tree-container"},We={class:"questions-main"},Ne={key:0},Oe={class:"main-header"},Pe={class:"count"},Xe={class:"header-actions"},Ze={key:0,class:"mt-4"},Ge={key:1,class:"questions-list mt-4"},Je=["onDragstart"],Ke=["innerHTML"],Ye={class:"q-meta"},et={class:"q-actions"},tt=["onClick"],st=["onClick"],at={key:0,class:"empty-state"},nt={key:1,class:"empty-state-main"},ot=F({__name:"LibraryView",setup(k){const u=fe(),{categoriesTree:w,questions:f}=pe(u),o=y(null),p=y(!1),h=y(null),m=y(300),a=y(!1),n=y(""),D=y("");me(async()=>{u.isLoaded||await u.loadData();const e=localStorage.getItem("library-sidebar-width");e&&(m.value=parseInt(e,10))});const d=A(()=>{if(!o.value)return[];let e=f.value.filter(t=>t.categoryId===o.value);if(D.value.trim()){const t=D.value.toLowerCase();e=e.filter(l=>l.text.toLowerCase().includes(t)||l.tags.some(c=>c.toLowerCase().includes(t)))}return e}),i=A(()=>{if(!n.value.trim())return w.value;const e=n.value.toLowerCase(),t=l=>l.reduce((c,C)=>{const L=C.name.toLowerCase().includes(e),B=t(C.children||[]);return(L||B.length>0)&&c.push({...C,children:B}),c},[]);return t(w.value)}),z=A(()=>{if(!o.value)return"";const e=u.categories.find(t=>t.id===o.value);return e?e.name:""});function G(e){o.value=e,p.value=!1}async function U(e){const t=prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:");t&&await u.addCategory({id:X(),name:t,parentId:e})}async function J(e){const t=prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:",e.name);!t||t===e.name||await u.updateCategory({...e,name:t})}async function K(e){confirm("–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã?")&&(await u.removeCategory(e),o.value===e&&(o.value=null))}function Y(){h.value=null,p.value=!0}function ee(e){h.value=e,p.value=!0}async function te(e){h.value?await u.updateQuestion(e):await u.addQuestion(e),p.value=!1,h.value=null}async function se(e){confirm("–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å?")&&await u.removeQuestion(e)}const S=y(null);function ae(e,t){S.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id))}const q=y(null);function ne(e,t){q.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.setData("type","question"))}async function oe(e,t){if(e.dataTransfer?.getData("type")==="question"&&q.value){q.value.categoryId!==t.id&&await u.updateQuestion({...q.value,categoryId:t.id}),q.value=null;return}const c=S.value?.id;if(!c||c===t.id)return;const C=u.categories.find(L=>L.id===c);C&&await u.updateCategory({...C,parentId:t.id}),S.value=null}function le(e){return["–õ–µ–≥–∫–∏–π","–ü—Ä–æ—Å—Ç–æ–π","–°—Ä–µ–¥–Ω–∏–π","–°–ª–æ–∂–Ω—ã–π","–≠–∫—Å–ø–µ—Ä—Ç"][e-1]||e}function ie(e){return e<=2?"diff-easy":e===3?"diff-medium":"diff-hard"}function re(e){a.value=!0,e.preventDefault()}function j(){a.value&&(a.value=!1,localStorage.setItem("library-sidebar-width",m.value.toString()))}function de(e){if(!a.value)return;const l=e.clientX-280;l>=200&&l<=600&&(m.value=l)}async function ue(e){if(e.preventDefault(),e.dataTransfer?.getData("type")==="question")return;const l=S.value?.id;if(!l)return;const c=u.categories.find(C=>C.id===l);c&&await u.updateCategory({...c,parentId:null}),S.value=null}function ce(e){e.preventDefault(),e.dataTransfer?.getData("type")!=="question"&&(e.dataTransfer.dropEffect="move")}return(e,t)=>(r(),v("div",{class:"library-layout",onMousemove:de,onMouseup:j,onMouseleave:j},[s("aside",{class:"categories-sidebar",style:ye({width:m.value+"px"})},[s("div",Ue,[t[4]||(t[4]=s("h2",null,"–ö–∞—Ç–µ–≥–æ—Ä–∏–∏",-1)),s("button",{class:"icon-btn",onClick:t[0]||(t[0]=l=>U(null)),title:"–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é"},[b(g(R),{size:20})])]),s("div",je,[I(s("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.value=l),type:"text",placeholder:"–ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",class:"search-input"},null,512),[[$,n.value]])]),s("div",{class:"drop-to-root-zone",onDrop:ue,onDragover:ce},[...t[5]||(t[5]=[s("span",{class:"drop-hint"},"üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ –∫–æ—Ä–µ–Ω—å",-1)])],32),s("div",Be,[b(Le,{nodes:i.value,selectedId:o.value,onSelect:G,onAdd:U,onEdit:J,onDelete:K,onDragstart:ae,onDrop:oe},null,8,["nodes","selectedId"])])],4),s("div",{class:"resizer",onMousedown:re},null,32),s("main",We,[o.value?(r(),v("div",Ne,[s("div",Oe,[s("h2",null,[W(x(z.value)+" ",1),s("span",Pe,"("+x(d.value.length)+")",1)]),s("div",Xe,[I(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>D.value=l),type:"text",placeholder:"–ü–æ–∏—Å–∫ –≤–æ–ø—Ä–æ—Å–æ–≤...",class:"search-input question-search"},null,512),[[$,D.value]]),p.value?E("",!0):(r(),v("button",{key:0,class:"primary",onClick:Y},[b(g(R),{size:16,style:{"margin-right":"8px"}}),t[6]||(t[6]=W(" –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å ",-1))]))])]),p.value?(r(),v("div",Ze,[b(He,{question:h.value,categoryId:o.value,onSave:te,onCancel:t[3]||(t[3]=l=>p.value=!1)},null,8,["question","categoryId"])])):(r(),v("div",Ge,[(r(!0),v(V,null,Q(d.value,l=>(r(),v("div",{key:l.id,class:"question-card"},[s("div",{class:"q-content",draggable:"true",onDragstart:c=>ne(c,l)},[s("div",{class:"q-text markdown-content",innerHTML:g(ge)(l.text)},null,8,Ke),s("div",Ye,[s("span",{class:O(["badge",ie(l.difficulty)])},x(le(l.difficulty)),3),(r(!0),v(V,null,Q(l.tags,c=>(r(),v("span",{key:c,class:"badge tag"},x(c),1))),128))])],40,Je),s("div",et,[s("button",{class:"icon-btn",onClick:c=>ee(l)},[b(g(Z),{size:16})],8,tt),s("button",{class:"icon-btn danger",onClick:c=>se(l.id)},[b(g(P),{size:16})],8,st)])]))),128)),d.value.length===0?(r(),v("p",at," –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤. ")):E("",!0)]))])):(r(),v("div",nt,[...t[7]||(t[7]=[s("p",null,"–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–æ–ø—Ä–æ—Å–∞–º–∏.",-1)])]))])],32))}}),ut=H(ot,[["__scopeId","data-v-e83400b6"]]);export{ut as default};
