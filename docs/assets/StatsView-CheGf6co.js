import{u as k}from"./data-CTdArvzf.js";import{c as x,d as A,r as u,l as w,x as D,m as _,a as n,f as s,i as m,u as p,C as L,t as i,p as C,B as I,g as z,F as B,b as T,o as c,n as V,_ as q}from"./index-CbXKj1MZ.js";import{a as M,d as N}from"./marked.esm-0Zu-3zCD.js";const $=x("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),F={class:"container"},Q={class:"stats-grid mt-4"},j={class:"card stat-card"},H={class:"stat-icon"},E={class:"stat-info"},R={class:"stat-value"},U={class:"card stat-card"},W={class:"stat-icon"},G={class:"stat-info"},J={class:"stat-value"},K={class:"card mt-4"},O={class:"flex justify-between items-center mb-4"},P=["disabled"],X=["innerHTML"],Y={key:1,class:"opacity-70"},Z={class:"card mt-4"},ss={class:"history-list mt-4"},ts={class:"history-header"},es={class:"date"},as={class:"history-q"},os={key:0,class:"opacity-70"},ns=A({__name:"StatsView",setup(is){const v=k(),o=u([]),y=u(!0),r=u(""),d=u(!1);w(async()=>{v.isLoaded||await v.loadData();const e=[];for(const t of v.questions){const a=await D.getAttemptsByQuestion(t.id);e.push(...a)}o.value=e.sort((t,a)=>a.date-t.date),y.value=!1});const l=_(()=>o.value.length),h=_(()=>l.value===0?0:(o.value.reduce((t,a)=>t+a.aiScore,0)/l.value).toFixed(1)),f=_(()=>o.value.slice(0,10));async function g(){if(o.value.length===0)return;d.value=!0;const e=`
    Total Attempts: ${l.value}
    Average Score: ${h.value}
    Recent Scores: ${o.value.slice(0,20).map(t=>t.aiScore).join(", ")}
    Weakest Questions (IDs): ...
  `;try{const t=await M.chat([{role:"system",content:"Ты аналитик обучения. Проанализируй статистику пользователя и дай советы по улучшению знаний. Будь краток и конструктивен."},{role:"user",content:`Вот моя статистика:
${e}`}],async()=>({}));r.value=t.content||"Не удалось получить анализ."}catch(t){console.error(t),r.value="Ошибка анализа."}finally{d.value=!1}}function S(e){return N(e||"")}function b(e){return new Date(e).toLocaleDateString()+" "+new Date(e).toLocaleTimeString()}return(e,t)=>(c(),n("div",F,[t[4]||(t[4]=s("h1",null,"Статистика",-1)),s("div",Q,[s("div",j,[s("div",H,[m(p(L),{size:32})]),s("div",E,[s("span",R,i(l.value),1),t[0]||(t[0]=s("span",{class:"stat-label"},"Всего ответов",-1))])]),s("div",U,[s("div",W,[m(p($),{size:32})]),s("div",G,[s("span",J,i(h.value),1),t[1]||(t[1]=s("span",{class:"stat-label"},"Средний балл",-1))])])]),s("div",K,[s("div",O,[t[2]||(t[2]=s("h3",null,"AI Анализ",-1)),s("button",{class:"primary",onClick:g,disabled:d.value||l.value===0},[m(p(I),{size:16,style:{"margin-right":"8px"}}),C(" "+i(d.value?"Анализ...":"Анализировать"),1)],8,P)]),r.value?(c(),n("div",{key:0,class:"markdown-body",innerHTML:S(r.value)},null,8,X)):(c(),n("p",Y,"Нажмите кнопку, чтобы получить советы от AI на основе вашей статистики."))]),s("div",Z,[t[3]||(t[3]=s("h3",null,"История активности",-1)),s("div",ss,[(c(!0),n(B,null,T(f.value,a=>(c(),n("div",{key:a.id,class:"history-item"},[s("div",ts,[s("span",es,i(b(a.date)),1),s("span",{class:V(["score",a.aiScore>=7?"text-success":"text-danger"])},i(a.aiScore)+"/10 ",3)]),s("div",as," Question ID: "+i(a.questionId.substring(0,8))+"... ",1)]))),128)),f.value.length===0?(c(),n("p",os,"История пуста.")):z("",!0)])])]))}}),ds=q(ns,[["__scopeId","data-v-73bc38ff"]]);export{ds as default};
