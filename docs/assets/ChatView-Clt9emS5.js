import{c as h,d as B,l as Q,r as y,m as S,z as q,a as i,f as l,g as k,F as b,b as g,j as p,u as f,i as C,k as L,v as D,A as H,B as U,o as s,n as F,h as x,t as K,_ as N}from"./index-CtsROhwf.js";import{a as j,d as E}from"./marked.esm-B71ftQBe.js";import{T as $}from"./trash-2-CP9PiXpz.js";import{v as I}from"./v4-EwEgHOG0.js";const M=h("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const G=h("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const P=h("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const R=h("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const J=h("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),O={class:"chat-layout"},W={class:"avatar"},X={class:"bubble"},Y=["innerHTML"],Z={key:1,class:"tool-calls"},ee={key:0,class:"message assistant"},te={class:"avatar"},ae={class:"bubble loading"},oe={class:"input-area"},se={class:"toolbar"},ne=["disabled","onKeydown"],re=["disabled"],ie=B({__name:"ChatView",setup(le){const r=Q(),c=y([]),v=y(""),d=y(!1),_=y(null),u=y(null);S(()=>{c.value.push({role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."})});async function m(){await U(),_.value&&(_.value.scrollTop=_.value.scrollHeight)}async function z(a,t){if(console.log("Tool Call:",a,t),a==="create_category"){const e=I();return await r.addCategory({id:e,name:t.name,parentId:t.parentId||null}),{success:!0,id:e,message:`Category "${t.name}" created.`}}if(a==="create_question"){const e=I();return await r.addQuestion({id:e,text:t.text,correctAnswer:t.correctAnswer,difficulty:t.difficulty,tags:t.tags||[],categoryId:t.categoryId,nextReviewDate:Date.now(),interval:0,repetitionFactor:2.5}),{success:!0,id:e,message:"Question created."}}if(a==="get_categories")return r.categories.map(e=>({id:e.id,name:e.name,parentId:e.parentId}));if(a==="update_category"){const e=r.categories.find(o=>o.id===t.id);return e?(await r.updateCategory({...e,name:t.name||e.name,parentId:t.parentId!==void 0?t.parentId:e.parentId}),{success:!0,message:"Category updated."}):{error:"Category not found"}}if(a==="delete_category")return await r.removeCategory(t.id),{success:!0,message:"Category deleted."};if(a==="get_questions"){let e=r.questions;t.categoryId&&(e=e.filter(n=>n.categoryId===t.categoryId));const o=t.limit||20;return e.slice(0,o).map(n=>({id:n.id,text:n.text,correctAnswer:n.correctAnswer,difficulty:n.difficulty,tags:n.tags,categoryId:n.categoryId}))}if(a==="update_question"){const e=r.questions.find(o=>o.id===t.id);return e?(await r.updateQuestion({...e,text:t.text||e.text,correctAnswer:t.correctAnswer||e.correctAnswer,difficulty:t.difficulty||e.difficulty,tags:t.tags||e.tags,categoryId:t.categoryId||e.categoryId}),{success:!0,message:"Question updated."}):{error:"Question not found"}}return a==="delete_question"?(await r.removeQuestion(t.id),{success:!0,message:"Question deleted."}):{error:"Unknown tool"}}function A(){u.value&&(u.value.abort(),u.value=null,d.value=!1,c.value.push({role:"assistant",content:"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."}),m())}function T(){confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?")&&(c.value=[{role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –ø–æ –∫–∞–∫–æ–π —Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã."}])}async function w(){if(!v.value.trim()||d.value)return;const a={role:"user",content:v.value};c.value.push(a),v.value="",d.value=!0,m(),u.value=new AbortController;try{const t=c.value.map(o=>({role:o.role,content:o.content,tool_calls:o.tool_calls,tool_call_id:o.tool_call_id,name:o.name})),e=await j.chat(t,z,u.value.signal);e.content?c.value.push({role:"assistant",content:e.content}):e.tool_calls&&c.value.push({role:"assistant",content:e.content||"–ì–æ—Ç–æ–≤–æ."})}catch(t){t.name==="AbortError"||c.value.push({role:"assistant",content:`–û—à–∏–±–∫–∞: ${t.message}`})}finally{u.value&&(d.value=!1,u.value=null),m()}}q(()=>{u.value&&u.value.abort()});function V(a){return E(a||"")}return(a,t)=>(s(),i("div",O,[l("div",{class:"chat-container",ref_key:"chatContainer",ref:_},[(s(!0),i(b,null,g(c.value,(e,o)=>(s(),i("div",{key:o,class:F(["message",e.role])},[l("div",W,[e.role==="assistant"?(s(),x(f(M),{key:0,size:24})):(s(),x(f(J),{key:1,size:24}))]),l("div",X,[e.content?(s(),i("div",{key:0,innerHTML:V(e.content),class:"markdown-content"},null,8,Y)):k("",!0),e.tool_calls?(s(),i("div",Z,[(s(!0),i(b,null,g(e.tool_calls,n=>(s(),i("div",{key:n.id,class:"tool-badge"}," üõ†Ô∏è "+K(n.function.name),1))),128))])):k("",!0)])],2))),128)),d.value?(s(),i("div",ee,[l("div",te,[p(f(M),{size:24})]),l("div",ae,[p(f(G),{size:20,class:"spin"})])])):k("",!0)],512),l("div",oe,[l("div",se,[l("button",{type:"button",onClick:T,class:"icon-btn",title:"–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"},[p(f($),{size:18})])]),l("form",{onSubmit:C(w,["prevent"]),class:"input-form"},[L(l("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ Vue 3 Composition API...",disabled:d.value,onKeydown:H(C(w,["exact","prevent"]),["enter"]),rows:"1",class:"chat-input"},null,40,ne),[[D,v.value]]),d.value?(s(),i("button",{key:0,type:"button",onClick:A,class:"stop-btn",title:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"},[p(f(R),{size:20,fill:"currentColor"})])):(s(),i("button",{key:1,type:"submit",disabled:!v.value.trim()},[p(f(P),{size:20})],8,re))],32)])]))}}),ve=N(ie,[["__scopeId","data-v-580718af"]]);export{ve as default};
