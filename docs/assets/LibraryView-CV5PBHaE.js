import{c as w,d as V,r as k,a as d,F as q,b as z,e as ee,o as r,f as e,g as Q,h as $,w as h,u as p,t as C,i as b,n as R,_ as M,j as te,k as I,v as T,l as se,s as ae,m as ne,p as E,q as F}from"./index-BMFIgAFt.js";import{T as j}from"./trash-2-SW9zr0n3.js";import{v as B}from"./v4-EwEgHOG0.js";const oe=w("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const le=w("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const ie=w("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const re=w("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const H=w("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const S=w("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),de={class:"tree-list"},ue=["onClick","onDragstart","onDrop"],ce=["onClick"],ve={key:1,class:"spacer"},fe={class:"node-name"},pe={class:"actions"},me=["onClick"],ye=["onClick"],ge=["onClick"],be={key:0,class:"children"},ke=V({__name:"CategoryTree",props:{nodes:{},selectedId:{}},emits:["select","add","edit","delete","dragstart","drop"],setup(_,{emit:u}){const c=u,m=k(new Set);function n(f){m.value.has(f)?m.value.delete(f):m.value.add(f)}function v(f){c("select",f)}return(f,l)=>{const o=ee("CategoryTree",!0);return r(),d("ul",de,[(r(!0),d(q,null,z(_.nodes,s=>(r(),d("li",{key:s.id,class:"tree-item"},[e("div",{class:R(["tree-content",{selected:_.selectedId===s.id}]),onClick:i=>v(s.id),draggable:"true",onDragstart:i=>c("dragstart",i,s),onDrop:i=>c("drop",i,s),onDragover:l[0]||(l[0]=h(()=>{},["prevent"]))},[s.children&&s.children.length>0?(r(),d("button",{key:0,class:"icon-btn toggle-btn",onClick:h(i=>n(s.id),["stop"])},[m.value.has(s.id)?(r(),$(p(oe),{key:0,size:16})):(r(),$(p(le),{key:1,size:16}))],8,ce)):(r(),d("span",ve)),m.value.has(s.id)?(r(),$(p(ie),{key:2,size:18,class:"folder-icon"})):(r(),$(p(re),{key:3,size:18,class:"folder-icon"})),e("span",fe,C(s.name),1),e("div",pe,[e("button",{class:"icon-btn",onClick:h(i=>c("add",s.id),["stop"]),title:"Add Subcategory"},[b(p(S),{size:14})],8,me),e("button",{class:"icon-btn",onClick:h(i=>c("edit",s),["stop"]),title:"Edit"},[b(p(H),{size:14})],8,ye),e("button",{class:"icon-btn danger",onClick:h(i=>c("delete",s.id),["stop"]),title:"Delete"},[b(p(j),{size:14})],8,ge)])],42,ue),m.value.has(s.id)&&s.children.length>0?(r(),d("div",be,[b(o,{nodes:s.children,selectedId:_.selectedId,onSelect:l[1]||(l[1]=i=>c("select",i)),onAdd:l[2]||(l[2]=i=>c("add",i)),onEdit:l[3]||(l[3]=i=>c("edit",i)),onDelete:l[4]||(l[4]=i=>c("delete",i)),onDragstart:l[5]||(l[5]=(i,x)=>c("dragstart",i,x)),onDrop:l[6]||(l[6]=(i,x)=>c("drop",i,x))},null,8,["nodes","selectedId"])])):Q("",!0)]))),128))])}}}),_e=M(ke,[["__scopeId","data-v-b71eabcd"]]),Ce={class:"editor-card"},he={class:"flex gap-4"},we={class:"flex-1"},xe={class:"flex-1"},De={class:"flex justify-end gap-2 mt-4"},$e=V({__name:"QuestionEditor",props:{question:{},categoryId:{}},emits:["save","cancel"],setup(_,{emit:u}){const c=_,m=u,n=k({text:"",correctAnswer:"",difficulty:1,tags:[]}),v=k("");te(()=>c.question,l=>{l?(n.value={...l},v.value=l.tags.join(", ")):(n.value={text:"",correctAnswer:"",difficulty:1,tags:[]},v.value="")},{immediate:!0});function f(){const l=v.value.split(",").map(s=>s.trim()).filter(s=>s),o={id:n.value.id||B(),text:n.value.text||"",correctAnswer:n.value.correctAnswer||"",difficulty:n.value.difficulty||1,tags:l,categoryId:c.categoryId,nextReviewDate:n.value.nextReviewDate||Date.now(),interval:n.value.interval||0,repetitionFactor:n.value.repetitionFactor||2.5};m("save",o)}return(l,o)=>(r(),d("div",Ce,[e("h3",null,C(_.question?"Редактировать вопрос":"Новый вопрос"),1),e("form",{onSubmit:h(f,["prevent"]),class:"flex flex-col gap-4"},[e("div",null,[o[5]||(o[5]=e("label",{class:"block mb-2 font-bold"},"Вопрос (Markdown)",-1)),I(e("textarea",{"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.text=s),rows:"4",required:""},null,512),[[T,n.value.text]])]),e("div",null,[o[6]||(o[6]=e("label",{class:"block mb-2 font-bold"},"Правильный ответ (Markdown)",-1)),I(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=s=>n.value.correctAnswer=s),rows:"4",required:""},null,512),[[T,n.value.correctAnswer]])]),e("div",he,[e("div",we,[o[7]||(o[7]=e("label",{class:"block mb-2 font-bold"},"Сложность (1-5)",-1)),I(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.difficulty=s),type:"number",min:"1",max:"5",required:""},null,512),[[T,n.value.difficulty,void 0,{number:!0}]])]),e("div",xe,[o[8]||(o[8]=e("label",{class:"block mb-2 font-bold"},"Теги (через запятую)",-1)),I(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>v.value=s),type:"text",placeholder:"js, vue, basics"},null,512),[[T,v.value]])])]),e("div",De,[e("button",{type:"button",onClick:o[4]||(o[4]=s=>m("cancel"))},"Отмена"),o[9]||(o[9]=e("button",{type:"submit",class:"primary"},"Сохранить",-1))])],32)]))}}),Ie=M($e,[["__scopeId","data-v-12c33e65"]]),Te={class:"library-layout"},Ae={class:"categories-sidebar"},qe={class:"sidebar-header"},ze={class:"tree-container"},Qe={class:"questions-main"},Se={key:0},Ve={class:"main-header"},Me={class:"count"},Le={key:0,class:"mt-4"},Ee={key:1,class:"questions-list mt-4"},Fe=["onDragstart"],Re={class:"q-text"},je={class:"q-meta"},Be={class:"q-actions"},He=["onClick"],Ue=["onClick"],Ne={key:0,class:"empty-state"},Pe={key:1,class:"empty-state-main"},Oe=V({__name:"LibraryView",setup(_){const u=se(),{categoriesTree:c,questions:m}=ae(u),n=k(null),v=k(!1),f=k(null);ne(async()=>{u.isLoaded||await u.loadData()});const l=E(()=>n.value?m.value.filter(t=>t.categoryId===n.value):[]),o=E(()=>{if(!n.value)return"";const t=u.categories.find(a=>a.id===n.value);return t?t.name:""});function s(t){n.value=t,v.value=!1}async function i(t){const a=prompt("Введите название категории:");a&&await u.addCategory({id:B(),name:a,parentId:t})}async function x(t){const a=prompt("Новое название:",t.name);!a||a===t.name||await u.updateCategory({...t,name:a})}async function U(t){confirm("Удалить категорию и все вложенные вопросы?")&&(await u.removeCategory(t),n.value===t&&(n.value=null))}function N(){f.value=null,v.value=!0}function P(t){f.value=t,v.value=!0}async function O(t){f.value?await u.updateQuestion(t):await u.addQuestion(t),v.value=!1,f.value=null}async function Z(t){confirm("Удалить вопрос?")&&await u.removeQuestion(t)}const A=k(null);function G(t,a){A.value=a,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",a.id))}const D=k(null);function J(t,a){D.value=a,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",a.id),t.dataTransfer.setData("type","question"))}async function K(t,a){if(t.dataTransfer?.getData("type")==="question"&&D.value){D.value.categoryId!==a.id&&await u.updateQuestion({...D.value,categoryId:a.id}),D.value=null;return}const g=A.value?.id;if(!g||g===a.id)return;const L=u.categories.find(Y=>Y.id===g);L&&await u.updateCategory({...L,parentId:a.id}),A.value=null}function W(t){return["Легкий","Простой","Средний","Сложный","Эксперт"][t-1]||t}function X(t){return t<=2?"diff-easy":t===3?"diff-medium":"diff-hard"}return(t,a)=>(r(),d("div",Te,[e("aside",Ae,[e("div",qe,[a[2]||(a[2]=e("h2",null,"Категории",-1)),e("button",{class:"icon-btn",onClick:a[0]||(a[0]=y=>i(null)),title:"Add Root Category"},[b(p(S),{size:20})])]),e("div",ze,[b(_e,{nodes:p(c),selectedId:n.value,onSelect:s,onAdd:i,onEdit:x,onDelete:U,onDragstart:G,onDrop:K},null,8,["nodes","selectedId"])])]),e("main",Qe,[n.value?(r(),d("div",Se,[e("div",Ve,[e("h2",null,[F(C(o.value)+" ",1),e("span",Me,"("+C(l.value.length)+")",1)]),v.value?Q("",!0):(r(),d("button",{key:0,class:"primary",onClick:N},[b(p(S),{size:16,style:{"margin-right":"8px"}}),a[3]||(a[3]=F(" Добавить вопрос ",-1))]))]),v.value?(r(),d("div",Le,[b(Ie,{question:f.value,categoryId:n.value,onSave:O,onCancel:a[1]||(a[1]=y=>v.value=!1)},null,8,["question","categoryId"])])):(r(),d("div",Ee,[(r(!0),d(q,null,z(l.value,y=>(r(),d("div",{key:y.id,class:"question-card"},[e("div",{class:"q-content",draggable:"true",onDragstart:g=>J(g,y)},[e("div",Re,C(y.text),1),e("div",je,[e("span",{class:R(["badge",X(y.difficulty)])},C(W(y.difficulty)),3),(r(!0),d(q,null,z(y.tags,g=>(r(),d("span",{key:g,class:"badge tag"},C(g),1))),128))])],40,Fe),e("div",Be,[e("button",{class:"icon-btn",onClick:g=>P(y)},[b(p(H),{size:16})],8,He),e("button",{class:"icon-btn danger",onClick:g=>Z(y.id)},[b(p(j),{size:16})],8,Ue)])]))),128)),l.value.length===0?(r(),d("p",Ne," В этой категории пока нет вопросов. ")):Q("",!0)]))])):(r(),d("div",Pe,[...a[4]||(a[4]=[e("p",null,"Выберите категорию слева, чтобы управлять вопросами.",-1)])]))])]))}}),Ke=M(Oe,[["__scopeId","data-v-e1b74a3a"]]);export{Ke as default};
